{# File: _add_edit_quiz_set_desktop.html #}
{# Desktop Version of Quiz Set Editor #}
{# Wrapped in hidden lg:block to show only on large screens #}

<div class="hidden lg:block h-full relative" id="desktop-quiz-set-wrapper">
    {# Desktop Header #}
    <div class="fixed inset-x-0 top-0 z-40 lg:ml-[250px] transition-all duration-300">
        <div
            class="flex items-center justify-between gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-white/95 backdrop-blur border-b border-gray-200 shadow-sm">
            <div class="flex items-center gap-2">
                <button type="button"
                    class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md"
                    data-role="close-editor">
                    <span>Thoát</span>
                </button>
            </div>
            <div class="flex items-center gap-2">
                {% if previous_set_id %}
                <a href="{{ url_for('.edit_quiz_set', set_id=previous_set_id) }}{{ modal_suffix }}"
                    class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 rounded-md">
                    <i class="fas fa-chevron-left"></i>
                    <span>Trước</span>
                </a>
                {% endif %}
                {% if next_set_id %}
                <a href="{{ url_for('.edit_quiz_set', set_id=next_set_id) }}{{ modal_suffix }}"
                    class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 rounded-md">
                    <span>Sau</span>
                    <i class="fas fa-chevron-right"></i>
                </a>
                {% endif %}
                <button type="submit" form="quizSetForm-desktop"
                    class="inline-flex items-center gap-2 px-3 py-2 text-sm font-semibold text-white bg-blue-600 hover:bg-blue-700 rounded-md shadow sm:px-4">
                    <i class="fas fa-save"></i>
                    <span>Lưu</span>
                </button>
            </div>
        </div>
    </div>

    <div class="pt-20 sm:pt-24"></div>

    {# Desktop Form Content #}
    <div class="p-3 sm:p-6 max-w-5xl mx-auto">
        <div class="w-full">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 sm:p-8">
                <h2 class="text-2xl font-bold text-center mb-6">{{ title }}</h2>

                {# Added suffix -desktop to ID #}
                <form id="quizSetForm-desktop" action="{{ form_action }}" method="post" enctype="multipart/form-data"
                    class="space-y-6">
                    {{ form.csrf_token(id="csrf_token-desktop") }}

                    <div class="space-y-3">
                        <div class="flex items-center justify-between flex-wrap gap-3">
                            <div>
                                {{ form.excel_file.label(class="block text-sm font-medium text-gray-700",
                                for="excel_file_input-desktop") }}
                                <p class="text-xs text-gray-500" data-role="excel-helper">{{ form.excel_file.description
                                    }}</p>
                                {% if template_excel_url %}
                                <a href="{{ template_excel_url }}" target="_blank"
                                    class="inline-flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800 mt-2">
                                    <i class="fas fa-download"></i>
                                    <span>Tải template mẫu (Excel)</span>
                                </a>
                                {% endif %}
                            </div>
                            <button type="button" class="text-sm text-gray-500 hover:text-red-500 transition hidden"
                                data-role="excel-clear">
                                Xóa file
                            </button>
                        </div>
                        <div data-role="excel-drop-zone" role="button" tabindex="0"
                            class="relative border-2 border-dashed border-blue-200 rounded-xl bg-blue-50/60 px-6 py-8 text-center transition duration-200 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-400">

                            {# Explicit ID mapping #}
                            <input id="excel_file_input-desktop" type="file" name="{{ form.excel_file.name }}"
                                class="hidden" accept=".xlsx">

                            <div class="flex flex-col items-center gap-2 pointer-events-none"
                                data-role="excel-placeholder">
                                <span
                                    class="flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-blue-500">
                                    <i class="fas fa-file-excel text-xl"></i>
                                </span>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Kéo thả file Excel vào đây hoặc bấm để
                                        chọn</p>
                                    <p class="text-xs text-gray-500">Hỗ trợ định dạng .xlsx, dung lượng tối đa 10MB.</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-blue-50 border border-blue-100 rounded-lg px-4 py-3 hidden"
                            data-role="excel-file-summary">
                            <p class="text-sm font-medium text-blue-700 flex items-center gap-2">
                                <i class="fas fa-check-circle"></i>
                                <span data-role="excel-file-name">Chưa chọn file</span>
                            </p>
                            <p class="text-xs text-blue-600 mt-1" data-role="excel-file-meta"></p>
                        </div>
                        <p class="text-sm hidden" data-role="excel-status"></p>
                    </div>

                    <div>
                        {{ form.title.label(class="block text-sm font-medium text-gray-700", for="title-desktop") }}
                        {{ form.title(id="title-desktop", class="mt-1 block w-full px-4 py-2 border border-gray-300
                        rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                        placeholder="Tiêu đề bộ Quiz") }}
                    </div>

                    <div>
                        {{ form.description.label(class="block text-sm font-medium text-gray-700",
                        for="description-desktop") }}
                        {{ form.description(id="description-desktop", class="mt-1 block w-full px-4 py-2 border
                        border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                        focus:border-blue-500", rows="3", placeholder="Mô tả bộ Quiz") }}
                    </div>

                    {% set current_cover = form.cover_image.data or '' %}
                    <div>
                        {{ form.cover_image.label(class="block text-sm font-medium text-gray-700",
                        for="cover_image-desktop") }}
                        <div class="mt-1 space-y-3" data-role="cover-wrapper" data-initial-url="{{ current_cover }}"
                            data-base-folder="{{ form.image_base_folder.data or '' }}">
                            {{ form.cover_image(id="cover_image-desktop", class="block w-full px-4 py-2 border
                            border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                            focus:border-blue-500", placeholder="VD: uploads/quizzes/covers/sample.jpg", **{'data-role':
                            'cover-input'}) }}
                            <div
                                class="relative border border-dashed border-gray-300 rounded-lg overflow-hidden bg-gray-50">
                                <img data-role="cover-preview" src="{{ current_cover }}" alt="Xem trước ảnh cover"
                                    class="w-full max-h-64 object-contain{% if not current_cover %} hidden{% endif %}">
                                <div data-role="cover-placeholder"
                                    class="flex items-center justify-center text-sm text-gray-400 py-10{% if current_cover %} hidden{% endif %}">
                                    Chưa có ảnh cover để xem trước.
                                </div>
                            </div>
                            <button type="button" data-role="cover-open"
                                class="text-sm text-blue-600 hover:text-blue-800 transition-colors duration-200 flex items-center gap-2{% if not current_cover %} hidden{% endif %}">
                                <i class="fas fa-external-link-alt"></i>
                                <span>Mở ảnh cover</span>
                            </button>
                            <p class="text-xs text-gray-500" data-role="cover-status"></p>
                        </div>
                    </div>

                    <div>
                        {{ form.tags.label(class="block text-sm font-medium text-gray-700", for="tags-desktop") }}
                        {{ form.tags(id="tags-desktop", class="mt-1 block w-full px-4 py-2 border border-gray-300
                        rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                        placeholder="ví dụ: Toán, Lịch sử, Tiếng Anh") }}
                    </div>

                    <div>
                        {{ form.image_base_folder.label(class="block text-sm font-medium text-gray-700",
                        for="image_base_folder-desktop") }}
                        <p class="text-xs text-gray-500 mb-1">{{ form.image_base_folder.description }}</p>
                        {{ form.image_base_folder(id="image_base_folder-desktop", class="mt-1 block w-full px-4 py-2
                        border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                        focus:border-blue-500", placeholder="vd: quiz/level1/images") }}
                    </div>

                    <div>
                        {{ form.audio_base_folder.label(class="block text-sm font-medium text-gray-700",
                        for="audio_base_folder-desktop") }}
                        <p class="text-xs text-gray-500 mb-1">{{ form.audio_base_folder.description }}</p>
                        {{ form.audio_base_folder(id="audio_base_folder-desktop", class="mt-1 block w-full px-4 py-2
                        border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                        focus:border-blue-500", placeholder="vd: quiz/level1/audio") }}
                    </div>

                    {% if current_user.user_role != 'free' %}
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Trạng thái công khai:</label>
                        <div class="flex items-center mt-2">
                            {{ form.is_public(id="is_public-desktop", class="h-4 w-4 text-blue-600 border-gray-300
                            rounded focus:ring-blue-500") }}
                            {{ form.is_public.label(class="ml-2 block text-sm text-gray-900", for="is_public-desktop")
                            }}
                        </div>
                    </div>
                    {% endif %}

                    <div class="border-t border-gray-200 pt-6">
                        {{ form.ai_prompt.label(class="block text-sm font-medium text-gray-700",
                        for="ai_prompt-desktop") }}
                        <p class="text-xs text-gray-500 mb-2">{{ form.ai_prompt.description }}</p>
                        {{ form.ai_prompt(id="ai_prompt-desktop", class="mt-1 block w-full px-4 py-2 border
                        border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500
                        focus:border-blue-500", rows="3", placeholder="Ví dụ: Tạo câu hỏi trắc nghiệm về lịch sử Việt
                        Nam.") }}
                    </div>

                    <div class="flex justify-end space-x-4 pt-4">
                        <button type="button" onclick="window.parent.closeModal()"
                            class="bg-gray-300 text-gray-800 px-6 py-2 rounded-md hover:bg-gray-400">Hủy</button>
                        {{ form.submit(id="submit-desktop", class="bg-blue-600 text-white px-6 py-2 rounded-md
                        hover:bg-blue-700") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>