{% extends "base.html" %}

{% block title %}M·ª•c ti√™u h·ªçc t·∫≠p{% endblock %}

{% block content %}
<div class="bg-gradient-to-b from-slate-900/5 via-slate-50 to-white py-10">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 space-y-10">
        <header class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6">
            <div>
                <p class="text-xs font-semibold uppercase tracking-[0.3em] text-indigo-500">M·ª•c ti√™u c√° nh√¢n</p>
                <h1 class="mt-2 text-3xl sm:text-4xl font-bold text-slate-900">Qu·∫£n l√Ω m·ª•c ti√™u h·ªçc t·∫≠p</h1>
                <p class="mt-3 text-sm sm:text-base text-slate-600 max-w-2xl">
                    L∆∞u tr·ªØ m·ª•c ti√™u c·ªßa ri√™ng b·∫°n, theo d√µi ti·∫øn ƒë·ªô v√† c·∫≠p nh·∫≠t khi ho√†n th√†nh. C√°c m·ª•c ti√™u n√†y s·∫Ω hi·ªÉn th·ªã tr·ª±c ti·∫øp tr√™n Dashboard ƒë·ªÉ b·∫°n lu√¥n gi·ªØ ƒë·ªông l·ª±c.
                </p>
            </div>
            <a href="{{ url_for('main.dashboard') }}" class="inline-flex items-center gap-2 text-sm font-semibold text-indigo-600 hover:text-indigo-800">
                <i class="fa-solid fa-arrow-left"></i> Quay l·∫°i Dashboard
            </a>
        </header>

        <section class="grid gap-8 lg:grid-cols-[1.1fr_0.9fr]">
            <div class="space-y-6">
                <div class="bg-white border border-slate-200 rounded-3xl shadow-sm p-8">
                    <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">Danh s√°ch m·ª•c ti√™u</p>
                    <h2 class="mt-2 text-xl font-semibold text-slate-900">Ti·∫øn ƒë·ªô hi·ªán t·∫°i</h2>
                    <p class="mt-2 text-sm text-slate-500">T·∫•t c·∫£ m·ª•c ti√™u ƒëang ho·∫°t ƒë·ªông c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª± ƒë·ªông d·ª±a tr√™n d·ªØ li·ªáu h·ªçc t·∫≠p.</p>

                    <div class="mt-6 space-y-4">
                        {% for goal in goal_progress %}
                            <div class="group rounded-2xl border border-slate-200 p-5 bg-white/80 backdrop-blur-sm hover:border-indigo-200 hover:shadow-lg transition-all">
                                <div class="flex flex-col gap-4">
                                    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                                        <div class="flex items-start gap-4">
                                            <span class="w-12 h-12 rounded-2xl bg-indigo-50 text-indigo-600 flex items-center justify-center text-lg">
                                                <i class="fa-solid fa-{{ goal.icon }}"></i>
                                            </span>
                                            <div>
                                                <div class="flex flex-wrap items-center gap-2">
                                                    <h3 class="text-lg font-semibold text-slate-900">{{ goal.title }}</h3>
                                                    <span class="inline-flex items-center gap-1 text-xs font-semibold tracking-widest uppercase text-indigo-600 bg-indigo-50 px-2.5 py-1 rounded-full">
                                                        {{ goal.period_label }}
                                                    </span>
                                                    {% if goal.due_date %}
                                                        <span class="inline-flex items-center gap-1 text-xs font-semibold text-amber-600 bg-amber-50 px-2.5 py-1 rounded-full">
                                                            <i class="fa-solid fa-clock"></i>
                                                            H·∫°n: {{ goal.due_date.strftime('%d/%m/%Y') }}
                                                        </span>
                                                    {% endif %}
                                                </div>
                                                <p class="mt-2 text-sm text-slate-500">{{ goal.description }}</p>
                                                {% if goal.notes %}
                                                    <p class="mt-1 text-sm text-slate-600">üí° {{ goal.notes }}</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="flex flex-col items-end gap-2">
                                            <p class="text-sm font-semibold text-slate-500">{{ goal.current_value }}/{{ goal.target_value }} {{ goal.unit }}</p>
                                            <a href="{{ goal.url }}" class="inline-flex items-center gap-2 text-xs font-semibold text-indigo-600 hover:text-indigo-800">
                                                Ti·∫øp t·ª•c h·ªçc <i class="fa-solid fa-arrow-up-right-from-square text-[0.65rem]"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-xs font-semibold uppercase tracking-[0.3em] text-slate-400">
                                            <span>Ti·∫øn ƒë·ªô</span>
                                            <span>{{ goal.percent }}%</span>
                                        </div>
                                        <div class="mt-2 h-2.5 rounded-full bg-slate-100 overflow-hidden">
                                            <div class="h-full rounded-full bg-gradient-to-r from-indigo-500 to-indigo-600" style="width: {{ goal.percent }}%"></div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-end gap-3 text-xs">
                                        <form method="post" action="{{ url_for('goals.toggle_goal', goal_id=goal.id) }}">
                                            {{ csrf_token() }}
                                            <button type="submit" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200">
                                                {% if goal.is_active %}
                                                    <i class="fa-solid fa-pause"></i> T·∫°m d·ª´ng m·ª•c ti√™u
                                                {% else %}
                                                    <i class="fa-solid fa-play"></i> K√≠ch ho·∫°t l·∫°i
                                                {% endif %}
                                            </button>
                                        </form>
                                        <a href="{{ url_for('goals.edit_goal', goal_id=goal.id) }}" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-600 hover:bg-indigo-100">
                                            <i class="fa-solid fa-pen"></i> Ch·ªânh s·ª≠a
                                        </a>
                                        <form method="post" action="{{ url_for('goals.delete_goal', goal_id=goal.id) }}" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m·ª•c ti√™u n√†y?');">
                                            {{ csrf_token() }}
                                            <button type="submit" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-rose-50 text-rose-600 hover:bg-rose-100">
                                                <i class="fa-solid fa-trash"></i> X√≥a
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-sm text-slate-500">B·∫°n ch∆∞a c√≥ m·ª•c ti√™u n√†o. H√£y t·∫°o m·ª•c ti√™u m·ªõi ·ªü khung b√™n c·∫°nh.</p>
                        {% endfor %}
                    </div>

                    {% if pagination.pages > 1 %}
                        <div class="mt-6 flex items-center justify-between text-sm text-slate-500">
                            <span>Trang {{ pagination.page }} / {{ pagination.pages }}</span>
                            <div class="flex items-center gap-2">
                                {% if pagination.has_prev %}
                                    <a href="{{ url_for('goals.manage_goals', page=pagination.prev_num) }}" class="px-3 py-1.5 rounded-full border border-slate-200 hover:border-indigo-200 hover:text-indigo-600">Tr∆∞·ªõc</a>
                                {% else %}
                                    <span class="px-3 py-1.5 rounded-full border border-slate-200 text-slate-300 cursor-not-allowed">Tr∆∞·ªõc</span>
                                {% endif %}
                                {% if pagination.has_next %}
                                    <a href="{{ url_for('goals.manage_goals', page=pagination.next_num) }}" class="px-3 py-1.5 rounded-full border border-slate-200 hover:border-indigo-200 hover:text-indigo-600">Sau</a>
                                {% else %}
                                    <span class="px-3 py-1.5 rounded-full border border-slate-200 text-slate-300 cursor-not-allowed">Sau</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="space-y-6">
                <div class="bg-slate-900 text-white rounded-3xl p-8 shadow-lg">
                    <p class="text-xs font-semibold uppercase tracking-[0.3em] text-white/50">Th√™m m·ª•c ti√™u</p>
                    <h2 class="mt-2 text-2xl font-semibold">L∆∞u m·ª•c ti√™u h·ªçc t·∫≠p m·ªõi</h2>
                    <p class="mt-3 text-sm text-white/70">Ch·ªçn lo·∫°i n·ªôi dung, kho·∫£ng th·ªùi gian v√† ƒë·∫∑t ch·ªâ s·ªë c·ª• th·ªÉ ƒë·ªÉ Mindstack theo d√µi gi√∫p b·∫°n.</p>

                    <form method="post" class="mt-6 space-y-5">
                        {{ form.hidden_tag() }}
                        <div class="grid gap-4 sm:grid-cols-2">
                            <div>
                                <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.goal_type.id }}">{{ form.goal_type.label.text }}</label>
                                {{ form.goal_type(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white placeholder-white/40 focus:border-white focus:ring-white/40') }}
                                {% if form.goal_type.errors %}
                                    <p class="mt-1 text-xs text-rose-200">{{ form.goal_type.errors[0] }}</p>
                                {% endif %}
                            </div>
                            <div>
                                <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.period.id }}">{{ form.period.label.text }}</label>
                                {{ form.period(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white focus:border-white focus:ring-white/40') }}
                                {% if form.period.errors %}
                                    <p class="mt-1 text-xs text-rose-200">{{ form.period.errors[0] }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div>
                            <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.target_value.id }}">{{ form.target_value.label.text }}</label>
                            {{ form.target_value(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white focus:border-white focus:ring-white/40', placeholder='V√≠ d·ª•: 20') }}
                            {% if form.target_value.errors %}
                                <p class="mt-1 text-xs text-rose-200">{{ form.target_value.errors[0] }}</p>
                            {% endif %}
                        </div>
                        <div>
                            <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.title.id }}">{{ form.title.label.text }}</label>
                            {{ form.title(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white focus:border-white focus:ring-white/40', placeholder='T√™n m·ª•c ti√™u c·ªßa b·∫°n') }}
                            {% if form.title.errors %}
                                <p class="mt-1 text-xs text-rose-200">{{ form.title.errors[0] }}</p>
                            {% endif %}
                        </div>
                        <div class="grid gap-4 sm:grid-cols-2">
                            <div>
                                <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.start_date.id }}">{{ form.start_date.label.text }}</label>
                                {{ form.start_date(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white focus:border-white focus:ring-white/40', placeholder='YYYY-MM-DD') }}
                                {% if form.start_date.errors %}
                                    <p class="mt-1 text-xs text-rose-200">{{ form.start_date.errors[0] }}</p>
                                {% endif %}
                            </div>
                            <div>
                                <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.due_date.id }}">{{ form.due_date.label.text }}</label>
                                {{ form.due_date(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white focus:border-white focus:ring-white/40', placeholder='YYYY-MM-DD') }}
                                {% if form.due_date.errors %}
                                    <p class="mt-1 text-xs text-rose-200">{{ form.due_date.errors[0] }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div>
                            <label class="text-xs font-semibold uppercase tracking-[0.3em] text-white/60" for="{{ form.notes.id }}">{{ form.notes.label.text }}</label>
                            {{ form.notes(class_='mt-2 w-full rounded-xl border border-white/10 bg-white/10 px-3 py-2 text-sm text-white focus:border-white focus:ring-white/40', rows='3', placeholder='Ghi ch√∫ ri√™ng c·ªßa b·∫°n...') }}
                            {% if form.notes.errors %}
                                <p class="mt-1 text-xs text-rose-200">{{ form.notes.errors[0] }}</p>
                            {% endif %}
                        </div>
                        {{ form.submit(class_='inline-flex items-center justify-center gap-2 w-full rounded-xl bg-white text-slate-900 font-semibold text-sm px-4 py-2.5 hover:bg-slate-100 transition') }}
                    </form>
                </div>

                <div class="bg-white border border-slate-200 rounded-3xl p-6">
                    <h3 class="text-lg font-semibold text-slate-900">M·∫πo ƒë·∫∑t m·ª•c ti√™u hi·ªáu qu·∫£</h3>
                    <ul class="mt-4 space-y-3 text-sm text-slate-600">
                        <li class="flex items-start gap-2"><i class="fa-solid fa-bullseye text-indigo-500 mt-1"></i> Ch·ªçn con s·ªë c·ª• th·ªÉ v√† ph√π h·ª£p v·ªõi l·ªãch h·ªçc hi·ªán t·∫°i.</li>
                        <li class="flex items-start gap-2"><i class="fa-solid fa-hourglass-half text-amber-500 mt-1"></i> Thi·∫øt l·∫≠p h·∫°n ho√†n th√†nh ƒë·ªÉ t·ª± t·∫°o deadline.</li>
                        <li class="flex items-start gap-2"><i class="fa-solid fa-repeat text-emerald-500 mt-1"></i> C·∫≠p nh·∫≠t m·ª•c ti√™u m·ªói khi ho√†n th√†nh ƒë·ªÉ duy tr√¨ ƒë·ªông l·ª±c.</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
</div>
{% endblock %}
