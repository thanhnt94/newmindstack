{# MCQ Session Template #}
{% extends "base.html" %}
{% block title %}Trắc nghiệm - {{ container.title }}{% endblock %}
{% block head %}
{{ super() }}
<style>
    body {
        font-family: 'Inter', sans-serif;
        background: #f8fafc;
    }

    @media (max-width: 1023px) {

        body>header,
        body>footer {
            display: none !important;
        }

        body>main {
            padding: 0 !important;
            margin: 0 !important;
            max-width: none !important;
        }
    }

    .mcq-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .mcq-header {
        background: white;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .mcq-back {
        width: 36px;
        height: 36px;
        border-radius: 0.75rem;
        background: #f1f5f9;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #64748b;
        cursor: pointer;
        text-decoration: none;
    }

    .mcq-title {
        font-weight: 700;
        color: #1e293b;
        flex: 1;
    }

    .mcq-score {
        font-weight: 700;
        color: #6366f1;
    }

    .mcq-content {
        flex: 1;
        padding: 1.5rem;
        max-width: 600px;
        margin: 0 auto;
        width: 100%;
    }

    .mcq-prompt {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        text-align: center;
        margin-bottom: 2rem;
    }

    .mcq-choices {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .mcq-choice {
        padding: 1rem 1.25rem;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 0.75rem;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
        color: #1e293b;
    }

    .mcq-choice:hover {
        border-color: #6366f1;
        background: #f5f3ff;
    }

    .mcq-choice.selected {
        border-color: #6366f1;
        background: #ede9fe;
    }

    .mcq-choice.correct {
        border-color: #10b981;
        background: #d1fae5;
        color: #059669;
    }

    .mcq-choice.wrong {
        border-color: #ef4444;
        background: #fee2e2;
        color: #dc2626;
    }

    .mcq-next {
        padding: 1rem;
        background: white;
        border-top: 1px solid #e2e8f0;
    }

    .mcq-next-btn {
        width: 100%;
        padding: 1rem;
        background: #6366f1;
        color: white;
        border: none;
        border-radius: 0.75rem;
        font-weight: 700;
        cursor: pointer;
        display: none;
    }

    .mcq-next-btn.show {
        display: block;
    }

    .mcq-complete {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .mcq-complete-box {
        background: white;
        padding: 2rem;
        border-radius: 1rem;
        text-align: center;
        max-width: 300px;
    }

    .mcq-complete-icon {
        font-size: 4rem;
        color: #10b981;
        margin-bottom: 1rem;
    }

    .mcq-complete-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }

    .mcq-complete-stats {
        color: #64748b;
        margin-bottom: 1rem;
    }

    .mcq-complete-btn {
        padding: 0.75rem 1.5rem;
        background: #6366f1;
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
    }
</style>
{% endblock %}
{% block content %}
<div class="mcq-container">
    <div class="mcq-header">
        <a href="{{ url_for('learning.vocabulary.dashboard') }}" class="mcq-back"><i class="fas fa-arrow-left"></i></a>
        <span class="mcq-title">{{ container.title }}</span>
        <span class="mcq-score"><span id="score">0</span>/<span id="total">{{ total_items }}</span></span>
    </div>
    <div class="mcq-content">
        <div class="mcq-prompt" id="prompt">Đang tải...</div>
        <div class="mcq-choices" id="choices"></div>
    </div>
    <div class="mcq-next">
        <button class="mcq-next-btn" id="next-btn">Câu tiếp theo</button>
    </div>
</div>
<div class="mcq-complete" id="complete-modal" style="display: none;">
    <div class="mcq-complete-box">
        <div class="mcq-complete-icon"><i class="fas fa-check-circle"></i></div>
        <div class="mcq-complete-title">Hoàn thành!</div>
        <div class="mcq-complete-stats">Đúng <span id="final-score">0</span>/<span id="final-total">0</span> câu</div>
        <button class="mcq-complete-btn" onclick="location.reload()">Chơi lại</button>
    </div>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
    (function () {
        var setId = {{ container.container_id }
    };
    var mode = '{{ mode }}';
    var questions = [];
    var current = 0;
    var score = 0;
    var answered = false;
    var promptEl = document.getElementById('prompt');
    var choicesEl = document.getElementById('choices');
    var nextBtn = document.getElementById('next-btn');
    var scoreEl = document.getElementById('score');

    // Fetch questions with mode
    fetch('/learn/vocabulary/mcq/api/questions/' + setId + '?count=10&mode=' + mode)
        .then(function (r) { return r.json(); })
        .then(function (data) {
            if (data.success) {
                questions = data.questions;
                document.getElementById('total').textContent = questions.length;
                document.getElementById('final-total').textContent = questions.length;
                showQuestion();
            }
        });
    function showQuestion() {
        if (current >= questions.length) {
            showComplete();
            return;
        }
        answered = false;
        nextBtn.classList.remove('show');
        var q = questions[current];
        promptEl.textContent = q.prompt;
        var html = '';
        q.choices.forEach(function (choice, i) {
            html += '<div class="mcq-choice" data-index="' + i + '" data-answer="' + choice + '">' + choice + '</div>';
        });
        choicesEl.innerHTML = html;
        document.querySelectorAll('.mcq-choice').forEach(function (el) {
            el.onclick = function () {
                if (answered) return;
                checkAnswer(el);
            };
        });
    }
    function checkAnswer(el) {
        answered = true;
        var selected = el.dataset.answer;
        var q = questions[current];
        if (selected === q.correct_answer) {
            el.classList.add('correct');
            score++;
            scoreEl.textContent = score;
        } else {
            el.classList.add('wrong');
            document.querySelectorAll('.mcq-choice').forEach(function (c) {
                if (c.dataset.answer === q.correct_answer) {
                    c.classList.add('correct');
                }
            });
        }
        nextBtn.classList.add('show');
    }
    nextBtn.onclick = function () {
        current++;
        showQuestion();
    };
    function showComplete() {
        document.getElementById('final-score').textContent = score;
        document.getElementById('complete-modal').style.display = 'flex';
    }
    }) ();
</script>
{% endblock %}