{#
  Shared flashcard display block for individual and collaborative modes.
  Base markup follows the individual flashcard session layout and can be
  extended for collab by passing collab_mode=True.
#}

{% set collab_mode = collab_mode | default(False) %}

{% if collab_mode %}
  <div class="card-surface flashcard-panel" id="collab-learning-card">
    <div class="flex items-start justify-between gap-3 collab-room-meta hidden lg:flex">
      <div>
        <p class="text-sm text-slate-500">Thẻ tiếp theo sẽ xuất hiện khi tất cả thành viên đã trả lời.</p>
        <div class="flex items-center gap-2 mt-2 text-sm text-slate-600">
          <span class="pill bg-amber-50 text-amber-700"><i class="fas fa-circle-notch animate-spin"></i> Đang tải thẻ đầu tiên...</span>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <div class="text-right">
          <p class="text-xs text-slate-500">Điểm của bạn</p>
          <p class="text-2xl font-extrabold text-indigo-600" id="collab-user-score">{{ current_user.total_score or 0 }}</p>
        </div>
        <button type="button" id="collab-refresh-round" class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-slate-200 text-sm font-semibold bg-white shadow-sm hover:bg-slate-50">
          <i class="fas fa-rotate"></i> Làm mới thẻ
        </button>
      </div>
    </div>

    <div class="flashcard-card-container">
      <div class="flashcard-card" id="collab-card">
        <div class="face front">
          <div class="card-toolbar">
            <div class="toolbar-left">
              <button type="button" class="icon-btn mobile-info-btn open-mobile-info-btn lg:hidden" title="Mở menu phòng"><i class="fas fa-bars"></i></button>
              <button type="button" class="icon-btn collab-ai-btn" title="Mindstack AI"><i class="fas fa-robot"></i></button>
              <button type="button" class="icon-btn collab-note-btn" title="Ghi chú"><i class="fas fa-sticky-note"></i></button>
            </div>
            <span class="label">MẶT TRƯỚC</span>
            <div class="toolbar-right">
              <button type="button" class="icon-btn collab-feedback-btn" title="Phản hồi"><i class="fas fa-flag"></i></button>
              <button type="button" class="icon-btn collab-edit-btn" title="Chỉnh sửa"><i class="fas fa-pencil-alt"></i></button>
              <button type="button" class="play-audio-btn collab-audio-btn" title="Nghe nội dung"><i class="fas fa-volume-up"></i></button>
            </div>
          </div>
          <div class="_card-container">
            <div class="text-area"><div id="collab-card-front" class="flashcard-content-text">—</div></div>
            <div class="media-container hidden" id="collab-card-front-media"></div>
          </div>
          <div class="flex justify-center p-4">
            <button type="button" id="collab-flip-btn" class="flip-card-btn">
              <i class="fas fa-sync-alt mr-2"></i>Lật thẻ
            </button>
          </div>
        </div>
        <div class="face back">
          <div class="card-toolbar">
            <div class="toolbar-left">
              <button type="button" class="icon-btn mobile-info-btn open-mobile-info-btn lg:hidden" title="Mở menu phòng"><i class="fas fa-bars"></i></button>
              <button type="button" class="icon-btn collab-ai-btn" title="Mindstack AI"><i class="fas fa-robot"></i></button>
              <button type="button" class="icon-btn collab-note-btn" title="Ghi chú"><i class="fas fa-sticky-note"></i></button>
            </div>
            <span class="label">MẶT SAU</span>
            <div class="toolbar-right">
              <button type="button" class="icon-btn collab-feedback-btn" title="Phản hồi"><i class="fas fa-flag"></i></button>
              <button type="button" class="icon-btn collab-edit-btn" title="Chỉnh sửa"><i class="fas fa-pencil-alt"></i></button>
              <button type="button" class="play-audio-btn collab-audio-btn" title="Nghe nội dung"><i class="fas fa-volume-up"></i></button>
            </div>
          </div>
          <div class="_card-container">
            <div class="text-area"><div id="collab-card-back" class="flashcard-content-text">—</div></div>
            <div class="media-container hidden" id="collab-card-back-media"></div>
          </div>
          <div class="actions" id="collab-answer-actions" data-button-count="3">
            <button type="button" data-answer="quên" class="collab-answer-btn btn rating-btn rating-btn--again">
              <span class="rating-btn__icon"><i class="fas fa-times"></i></span>
              <span class="rating-btn__title">Quên</span>
            </button>
            <button type="button" data-answer="mơ_hồ" class="collab-answer-btn btn rating-btn rating-btn--hard">
              <span class="rating-btn__icon"><i class="fas fa-adjust"></i></span>
              <span class="rating-btn__title">Mơ hồ</span>
            </button>
            <button type="button" data-answer="nhớ" class="collab-answer-btn btn rating-btn rating-btn--good">
              <span class="rating-btn__icon"><i class="fas fa-check"></i></span>
              <span class="rating-btn__title">Nhớ</span>
            </button>
          </div>
          <p id="collab-answer-feedback" class="text-xs text-slate-600 px-6 pb-2"></p>
        </div>
      </div>
    </div>
  </div>
{% else %}
  <div class="flashcard-wrapper">
    <div class="card-surface">
      <div class="flashcard-panel">
        <div id="flashcard-content">
          <div class="flex flex-col items-center justify-center h-full text-blue-500 min-h-[300px]"><i class="fas fa-spinner fa-spin text-4xl mb-3"></i><p>Đang tải thẻ...</p></div>
        </div>
        <div id="flashcard-buttons" class="mt-3"></div>
      </div>
    </div>
  </div>
{% endif %}
