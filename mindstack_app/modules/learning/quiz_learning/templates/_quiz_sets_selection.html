<!-- File: newmindstack/mindstack_app/modules/learning/quiz_learning/templates/_quiz_sets_selection.html -->
<!-- Phiên bản: 1.10 -->
<!-- Mục đích: Partial template hiển thị danh sách các bộ Quiz để người dùng lựa chọn. -->
<!-- ĐÃ SỬA: Tái tích hợp phân trang trong template và đảm bảo truyền đủ các tham số. -->
<!-- ĐÃ THÊM: Truyền current_filter để phân trang và tìm kiếm giữ được trạng thái. -->
<!-- ĐÃ SỬA: Ẩn tùy chọn "Làm tất cả các bộ" khi ở tab "Khám phá" HOẶC khi có ít hơn 2 bộ câu hỏi. -->
<!-- ĐÃ THÊM: Vô hiệu hóa trực quan và ngăn chặn click cho các bộ quiz có 0 câu hỏi. -->

{% from 'includes/_search_form.html' import render_search_form %}
{% from 'includes/_pagination.html' import render_pagination %}

<div class="w-full">
    <div class="mb-4">
        {# Form tìm kiếm cho bộ Quiz #}
        {% set search_options_display = {
            'title': 'Tiêu đề',
            'description': 'Mô tả',
            'tags': 'Thẻ'
        } %}
        {{ render_search_form(search_query=search_query, placeholder="Tìm kiếm bộ câu hỏi...", search_field=search_field, search_options=search_options_display) }}
    </div>

    {% if quiz_sets %}
    <div class="space-y-3">
        {# Option để học tất cả các bộ (chỉ hiện khi filter là 'doing' VÀ có từ 2 bộ trở lên) #}
        {% if current_filter == 'doing' and quiz_sets|length >= 2 %}
        <div class="quiz-set-item bg-gray-50 p-4 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors duration-200 flex justify-between items-center" data-set-id="all" data-total-items="all">
            <div>
                <h3 class="font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-infinity mr-2 text-gray-600"></i> Làm tất cả các bộ
                </h3>
            </div>
            {# Số lượng tổng cộng sẽ được tính ở backend và hiển thị ở chế độ học #}
        </div>
        {% endif %}

        {% for set in quiz_sets %}
        {# Thêm class để vô hiệu hóa và title nếu total_items là 0 #}
        {% set is_disabled = (set.total_items == 0) %}
        <div class="quiz-set-item bg-white p-4 rounded-lg border border-gray-200 transition-colors duration-200 flex flex-col {% if is_disabled %}opacity-50 cursor-not-allowed{% else %}cursor-pointer hover:bg-gray-100{% endif %}" 
             data-set-id="{{ set.container_id }}" 
             data-total-items="{{ set.total_items }}"
             {% if is_disabled %}title="Bộ câu hỏi này chưa có câu nào. Không thể chọn."{% endif %}>
            <h3 class="font-semibold text-gray-800">{{ set.title }}</h3>
            {# Hiển thị tiến độ học: Đã học / Tổng số #}
            <p class="text-gray-600 text-sm">{{ set.item_count }}</p>
            <p class="text-gray-500 text-xs">tạo bởi {{ set.creator.username }}</p>
        </div>
        {% endfor %}
    </div>

    {# Phân trang đã được khôi phục #}
    {{ render_pagination(pagination=pagination, search_query=search_query, search_field=search_field, current_filter=current_filter) }}
    {% else %}
    <div class="text-center py-12 px-6 text-gray-600">
        <i class="fas fa-question-circle text-5xl text-gray-300 mb-4"></i>
        <p>Không tìm thấy bộ câu hỏi nào phù hợp.</p>
        <p class="text-sm text-gray-500 mt-2">Hãy thử thay đổi bộ lọc hoặc tìm kiếm.</p>
    </div>
    {% endif %}
</div>
