{#
    # File: mindstack_app/modules/feedback/templates/feedback/_feedback_table.html
    # Phiên bản: 1.2
    # MỤC ĐÍCH: Hỗ trợ chức năng 'Sửa nhanh' cho các phản hồi về Quiz.
    # ĐÃ SỬA: Thêm điều kiện để tạo URL 'Sửa nhanh' cho cả Flashcard và Quiz.
#}
<div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Đối tượng Phản hồi</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phản hồi</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Người gửi</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Thời gian</th>
                {% if is_owner %}
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hành động</th>
                {% endif %}
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {% for feedback in feedbacks %}
            <tr class="hover:bg-gray-50">
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">
                        {# Hiển thị nội dung mặt trước của thẻ hoặc câu hỏi quiz #}
                        {% if feedback.item.item_type == 'FLASHCARD' %}
                            {{ feedback.item.content.front }}
                        {% elif feedback.item.item_type.startswith('QUIZ_') %}
                            {{ feedback.item.content.question }}
                        {% else %}
                            Item ID: {{ feedback.item.item_id }}
                        {% endif %}
                    </div>
                    <div class="text-xs text-gray-500">
                        {{ feedback.item.container.title }}
                    </div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-gray-800 break-words max-w-xs">{{ feedback.content }}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if feedback.status == 'new' %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">Mới</span>
                    {% elif feedback.status == 'resolved' %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Đã giải quyết</span>
                    {% elif feedback.status == 'wont_fix' %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">Bỏ qua</span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ feedback.reporter.username }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ feedback.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
                {% if is_owner %}
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <div class="flex items-center space-x-2">
                        {# Logic cho nút Sửa nhanh #}
                        {% set set_id = feedback.item.container_id %}
                        {% set item_id = feedback.item.item_id %}
                        {% set edit_url = '' %}

                        {% if feedback.item.item_type == 'FLASHCARD' %}
                            {% set edit_url = url_for('content_management.content_management_flashcards.edit_flashcard_item', set_id=set_id, item_id=item_id) %}
                        {% elif feedback.item.item_type.startswith('QUIZ_') %}
                             {% set edit_url = url_for('content_management.content_management_quizzes.edit_quiz_item', set_id=set_id, item_id=item_id) %}
                        {% endif %}
                        
                        {% if edit_url %}
                        <a href="#" onclick="window.parent.openModal('{{ edit_url }}')" class="text-blue-600 hover:text-blue-900" title="Sửa nhanh">
                            <i class="fas fa-pencil-alt"></i>
                        </a>
                        {% endif %}

                        {# Các nút xử lý khác #}
                        {% if feedback.status == 'new' %}
                        <form action="{{ url_for('feedback.resolve_feedback', feedback_id=feedback.feedback_id) }}" method="POST" class="inline">
                            <button type="submit" class="text-green-600 hover:text-green-900" title="Đánh dấu đã giải quyết"><i class="fas fa-check-circle"></i></button>
                        </form>
                        <form action="{{ url_for('feedback.ignore_feedback', feedback_id=feedback.feedback_id) }}" method="POST" class="inline">
                            <button type="submit" class="text-gray-500 hover:text-gray-800" title="Bỏ qua"><i class="fas fa-ban"></i></button>
                        </form>
                        {% endif %}
                    </div>
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>