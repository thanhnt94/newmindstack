{% extends "admin_layout.html" %}
{% set active_page = 'backup' %}

{% block title %}Sao lưu & khôi phục{% endblock %}
{% block page_title %}Sao lưu và khôi phục dữ liệu{% endblock %}
{% block page_subtitle %}Tạo bản sao lưu toàn bộ dữ liệu và khôi phục nhanh chóng khi cần thiết.{% endblock %}

{% block content %}
<div class="space-y-8">
    <div class="data-card">
        <div class="data-card-header px-6 py-5 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
            <div>
                <h2 class="text-xl font-semibold text-slate-900">Tạo bản sao lưu mới</h2>
                <p class="text-sm text-slate-500">Lưu lại cơ sở dữ liệu và toàn bộ thư mục uploads vào một gói zip duy nhất.</p>
            </div>
            <form action="{{ url_for('admin.create_backup') }}" method="post" onsubmit="return confirm('Bạn có chắc chắn muốn tạo bản sao lưu mới không?');">
                <button type="submit" class="inline-flex items-center gap-2 bg-blue-600 text-white px-5 py-2.5 rounded-md shadow hover:bg-blue-500 transition">
                    <i class="fas fa-plus-circle"></i> Tạo bản sao lưu ngay
                </button>
            </form>
        </div>
    </div>

    <div class="data-card">
        <div class="data-card-header px-6 py-5 flex items-center justify-between">
            <h2 class="text-xl font-semibold text-slate-900">Các bản sao lưu hiện có</h2>
            <span class="text-sm text-slate-500">{{ backup_files|length }} bản sao lưu được lưu trữ</span>
        </div>
        <div class="px-6 py-6">
            {% if backup_files %}
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200 text-sm">
                    <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
                        <tr>
                            <th class="px-5 py-3 text-left font-semibold">Tên file</th>
                            <th class="px-5 py-3 text-left font-semibold">Ngày tạo</th>
                            <th class="px-5 py-3 text-left font-semibold">Thao tác</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {% for file in backup_files %}
                        <tr class="hover:bg-slate-50">
                            <td class="px-5 py-4 font-medium text-slate-900">{{ file }}</td>
                            <td class="px-5 py-4 text-slate-600">{{ file.split('_')[1] }} {{ file.split('_')[2].split('.')[0] }}</td>
                            <td class="px-5 py-4">
                                <form action="{{ url_for('admin.restore_backup', filename=file) }}" method="post" onsubmit="return confirm('Khôi phục sẽ ghi đè toàn bộ dữ liệu hiện tại. Bạn có chắc chắn muốn tiếp tục?');" class="inline-flex">
                                    <button type="submit" class="inline-flex items-center gap-2 bg-rose-100 text-rose-700 px-4 py-2 rounded-md hover:bg-rose-200 transition">
                                        <i class="fas fa-rotate"></i> Khôi phục
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-sm text-slate-500">Hiện chưa có bản sao lưu nào. Hãy tạo bản sao lưu đầu tiên để đảm bảo an toàn dữ liệu.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
