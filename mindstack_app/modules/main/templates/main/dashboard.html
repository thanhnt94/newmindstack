{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block head %}
    {{ super() }}
    <style>
        /* CSS cho thanh cu·ªôn t√πy ch·ªânh (ch·ªâ √°p d·ª•ng n∆°i g√°n class) */
        .custom-scrollbar-dark::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar-dark::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .custom-scrollbar-dark::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        .custom-scrollbar-dark::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
            background-clip: content-box;
        }
    </style>
{% endblock %}

{% block content %}
<div class="bg-transparent">
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        <div class="grid gap-6 xl:grid-cols-3 items-stretch">
            <!-- C·ªòT TR√ÅI -->
            <section id="left-column" class="xl:col-span-2 bg-white/80 backdrop-blur border border-slate-100 rounded-3xl shadow-sm p-8 lg:p-10 space-y-8 h-full">
                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-8">
                    <div class="max-w-2xl">
                        <p class="text-xs font-semibold uppercase tracking-[0.35em] text-indigo-500">Nh·∫≠t k√Ω h√¥m nay</p>
                        <h1 class="mt-3 text-3xl sm:text-4xl font-bold text-slate-900 leading-tight">Xin ch√†o, {{ current_user.username }} üëã</h1>
                        <p class="mt-4 text-sm sm:text-base text-slate-600 leading-relaxed">{{ motivation_message }}</p>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4 w-full lg:w-auto">
                        {% for card in score_cards %}
                            <div class="rounded-2xl bg-gradient-to-br {{ card.accent }} text-white p-4 sm:p-5 shadow-sm">
                                <div class="flex items-center justify-between gap-3">
                                    <span class="text-[10px] sm:text-xs font-semibold uppercase tracking-[0.35em] text-white/70">{{ card.label }}</span>
                                    <span class="w-9 h-9 rounded-xl bg-white/20 flex items-center justify-center">
                                        <i class="fa-solid fa-{{ card.icon }} text-sm"></i>
                                    </span>
                                </div>
                                <p class="mt-4 text-3xl sm:text-4xl font-bold tracking-tight">{{ "{:,}".format(card.value) }}</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="grid gap-4 sm:grid-cols-3">
                    <div class="p-5 rounded-2xl border border-indigo-100 bg-indigo-50/70">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-semibold text-indigo-700">Flashcard ƒë·∫øn h·∫°n</p>
                            <span class="text-[10px] uppercase font-semibold text-indigo-600 bg-white px-2 py-0.5 rounded-full">S·∫µn s√†ng</span>
                        </div>
                        <p class="mt-4 text-3xl font-bold text-indigo-700">{{ flashcard_summary.due }}</p>
                        <p class="mt-2 text-xs text-indigo-500">Gi·∫£i quy·∫øt ƒë·ªÉ duy tr√¨ chu·ªói h·ªçc ·ªïn ƒë·ªãnh.</p>
                    </div>
                    <div class="p-5 rounded-2xl border border-emerald-100 bg-emerald-50/70">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-semibold text-emerald-700">Quiz ƒë√£ n·∫Øm v·ªØng</p>
                            <span class="text-[10px] uppercase font-semibold text-emerald-600 bg-white px-2 py-0.5 rounded-full">Ti·∫øn b·ªô</span>
                        </div>
                        <p class="mt-4 text-3xl font-bold text-emerald-700">{{ quiz_summary.mastered }}</p>
                        <p class="mt-2 text-xs text-emerald-500">{{ quiz_summary.completion_percent }}% c√¢u h·ªèi ƒë√£ th√†nh th·∫°o.</p>
                    </div>
                    <div class="p-5 rounded-2xl border border-amber-100 bg-amber-50/70">
                        <div class="flex items-center justify-between">
                            <p class="text-sm font-semibold text-amber-700">Ti·∫øn ƒë·ªô kh√≥a h·ªçc</p>
                            <span class="text-[10px] uppercase font-semibold text-amber-600 bg-white px-2 py-0.5 rounded-full">L·ªô tr√¨nh</span>
                        </div>
                        <p class="mt-4 text-3xl font-bold text-amber-700">{{ course_summary.avg_completion }}%</p>
                        <p class="mt-2 text-xs text-amber-500">Trung b√¨nh ho√†n th√†nh tr√™n c√°c kh√≥a ƒëang theo h·ªçc.</p>
                    </div>
                </div>
            </section>

            <!-- C·ªòT PH·∫¢I -->
            <section class="space-y-6 h-full flex flex-col">
                <!-- S·ª¨A: ch·ªâ b·∫≠t overflow/height ‚Äúk·ªπ thu·∫≠t‚Äù ·ªü lg tr·ªü l√™n -->
                <div class="bg-slate-900 text-white rounded-3xl p-8 shadow-lg space-y-6 flex flex-col lg:flex-grow lg:overflow-hidden">
                    <div class="flex items-start justify-between gap-4 flex-shrink-0">
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-[0.35em] text-white/60">Nh·∫Øc nh·ªü h√†nh ƒë·ªông</p>
                            <h2 class="mt-3 text-2xl font-semibold">M·ª•c ti√™u &amp; b∆∞·ªõc ti·∫øp theo</h2>
                        </div>
                        <a href="{{ url_for('goals.manage_goals') }}" class="inline-flex items-center gap-2 text-xs font-semibold text-white/80 hover:text-white bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-full transition flex-shrink-0">
                            <i class="fa-solid fa-sliders"></i> Qu·∫£n l√Ω
                        </a>
                    </div>

                    <!-- S·ª¨A QUAN TR·ªåNG:
                         - Mobile: overflow-visible, h-auto, min-h ƒë·ªÉ lu√¥n th·∫•y n·ªôi dung
                         - Desktop (lg+): overflow-y-auto + flex-grow + h-0 ƒë·ªÉ c√≥ v√πng cu·ªôn ƒë·∫πp
                    -->
                    <div class="space-y-4 pr-2 min-h-[180px] custom-scrollbar-dark
                                overflow-visible h-auto
                                lg:overflow-y-auto lg:flex-grow lg:h-0">
                        {% for goal in goal_progress %}
                            <div class="rounded-2xl bg-white/10 hover:bg-white/15 transition-all p-4 flex-shrink-0">
                                <div class="flex flex-col gap-4">
                                    <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
                                        <div class="flex items-start gap-3">
                                            <span class="w-11 h-11 rounded-xl bg-white/15 flex items-center justify-center text-lg flex-shrink-0">
                                                <i class="fa-solid fa-{{ goal.icon }}"></i>
                                            </span>
                                            <div>
                                                <div class="flex flex-wrap items-center gap-2">
                                                    <h3 class="text-lg font-semibold text-white">{{ goal.title }}</h3>
                                                    <span class="inline-flex items-center gap-1 text-[10px] font-semibold uppercase tracking-[0.3em] text-indigo-200 bg-white/10 px-2 py-1 rounded-full">{{ goal.period_label }}</span>
                                                    {% if goal.due_date %}
                                                        <span class="inline-flex items-center gap-1 text-[10px] font-semibold text-amber-200 bg-white/10 px-2 py-1 rounded-full">
                                                            <i class="fa-solid fa-clock"></i> H·∫°n {{ goal.due_date.strftime('%d/%m/%Y') }}
                                                        </span>
                                                    {% endif %}
                                                </div>
                                                <p class="mt-2 text-sm text-white/80">{{ goal.description }}</p>
                                                {% if goal.notes %}
                                                    <p class="mt-2 text-sm text-white/70 italic">‚Äú{{ goal.notes }}‚Äù</p>
                                                {% endif %}
                                                {% if goal.start_date %}
                                                    <p class="mt-2 text-xs text-white/60">B·∫Øt ƒë·∫ßu t·ª´ {{ goal.start_date.strftime('%d/%m/%Y') }}</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <a href="{{ goal.url }}" class="inline-flex items-center gap-2 text-xs font-semibold text-indigo-200 hover:text-white transition flex-shrink-0">
                                            ƒêi t·ªõi m·ª•c ti√™u <i class="fa-solid fa-arrow-up-right-from-square text-[0.65rem]"></i>
                                        </a>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-[10px] font-semibold uppercase tracking-[0.35em] text-white/60">
                                            <span>Ti·∫øn ƒë·ªô ({{ goal.current_value }}/{{ goal.target_value }} {{ goal.unit }})</span>
                                            <span>{{ goal.percent }}%</span>
                                        </div>
                                        <div class="mt-2 h-2.5 rounded-full bg-white/10 overflow-hidden">
                                            <div class="h-full rounded-full bg-white" style="width: {{ goal.percent }}%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-sm text-white/70">B·∫°n ch∆∞a c√≥ m·ª•c ti√™u ƒëang ho·∫°t ƒë·ªông. H√£y ƒë·∫∑t m·ª•c ti√™u h·ªçc t·∫≠p m·ªõi ·ªü trang Qu·∫£n l√Ω M·ª•c ti√™u.</p>
                        {% endfor %}
                    </div>
                </div>
            </section>
        </div>

        <!-- PH·∫¶N D∆Ø·ªöI: gi·ªØ nguy√™n -->
        <section class="grid gap-6 xl:grid-cols-3 items-start">
            <div class="xl:col-span-2 space-y-6">
                <div class="bg-white rounded-3xl shadow-sm border border-slate-100 p-8">
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <div>
                            <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">T·ªïng h·ª£p th√†nh t·ª±u</p>
                            <h3 class="mt-2 text-xl font-semibold text-slate-900">B·∫°n ƒë√£ l√†m ƒë∆∞·ª£c g√¨ ƒë·∫øn hi·ªán t·∫°i?</h3>
                        </div>
                        <a href="{{ url_for('stats.dashboard') }}" class="text-sm font-semibold text-indigo-600 hover:text-indigo-500">Xem th·ªëng k√™ chi ti·∫øt ‚Üí</a>
                    </div>

                    <div class="mt-6 grid gap-4 md:grid-cols-2">
                        {% for achievement in achievements %}
                            <div class="rounded-2xl border border-slate-100 p-5">
                                <div class="flex items-center justify-between gap-4">
                                    <span class="text-sm font-semibold text-slate-600">{{ achievement.label }}</span>
                                    <span class="w-9 h-9 rounded-xl flex items-center justify-center text-{{ achievement.tone }}-500 bg-{{ achievement.tone }}-50">
                                        <i class="fa-solid fa-{{ achievement.icon }}"></i>
                                    </span>
                                </div>
                                <p class="mt-3 text-3xl font-bold text-slate-900">{{ "{:,}".format(achievement.value) }}</p>
                                <p class="mt-2 text-xs text-slate-500">{{ achievement.detail }}</p>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="mt-8 grid gap-4 sm:grid-cols-3">
                        {% for snapshot in progress_snapshots %}
                            <div class="rounded-2xl border border-slate-100 bg-slate-50 p-5">
                                <div class="flex items-center gap-3">
                                    <span class="w-9 h-9 rounded-xl bg-white flex items-center justify-center text-slate-500">
                                        <i class="fa-solid fa-{{ snapshot.icon }}"></i>
                                    </span>
                                    <p class="text-sm font-semibold text-slate-700">{{ snapshot.label }}</p>
                                </div>
                                <p class="mt-3 text-2xl font-bold text-slate-900">{{ snapshot.value }} <span class="text-base font-medium text-slate-500">{{ snapshot.unit }}</span></p>
                                <p class="mt-1 text-xs text-slate-500">{{ snapshot.trend }}</p>
                            </div>
                        {% endfor %}
                    </div>

                    <div class="mt-8 border-t border-slate-100 pt-6 text-sm text-slate-500">
                        <p>Duy tr√¨ nh·ªãp h·ªçc t·∫≠p ·ªïn ƒë·ªãnh s·∫Ω gi√∫p b·∫°n ƒë·∫°t m·ª•c ti√™u nhanh h∆°n. Ti·∫øp t·ª•c gi·ªØ phong ƒë·ªô nh√©!</p>
                    </div>
                </div>

                <div class="bg-white rounded-3xl shadow-sm border border-slate-100 p-8">
                    <div>
                        <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">Kh√°m ph√° th√™m</p>
                        <h3 class="mt-2 text-xl font-semibold text-slate-900">Ch·ªçn ho·∫°t ƒë·ªông ƒë·ªÉ ti·∫øp t·ª•c ƒë√† h·ªçc t·∫≠p</h3>
                    </div>

                    <div class="mt-6 grid gap-6 md:grid-cols-2 lg:grid-cols-4">
                        <a href="{{ url_for('learning.flashcard_learning.flashcard_learning_dashboard') }}" class="group bg-indigo-50 border border-indigo-100 rounded-2xl p-6 hover:border-indigo-200 transition-all">
                            <div class="flex items-center justify-between">
                                <span class="text-lg font-semibold text-indigo-700">Flashcard</span>
                                <i class="fa-solid fa-clone text-indigo-500"></i>
                            </div>
                            <p class="mt-3 text-sm text-indigo-600">√în luy·ªán v·ªõi h·ªá th·ªëng l·∫∑p l·∫°i ng·∫Øt qu√£ng th√¥ng minh.</p>
                            <span class="mt-6 inline-flex items-center gap-2 text-xs font-semibold text-indigo-600 group-hover:text-indigo-800">B·∫Øt ƒë·∫ßu √¥n t·∫≠p <i class="fa-solid fa-arrow-right text-[0.65rem]"></i></span>
                        </a>

                        <a href="{{ url_for('learning.quiz_learning.quiz_learning_dashboard') }}" class="group bg-emerald-50 border border-emerald-100 rounded-2xl p-6 hover:border-emerald-200 transition-all">
                            <div class="flex items-center justify-between">
                                <span class="text-lg font-semibold text-emerald-700">Quiz</span>
                                <i class="fa-solid fa-question-circle text-emerald-500"></i>
                            </div>
                            <p class="mt-3 text-sm text-emerald-600">Th·ª≠ s·ª©c v·ªõi c√°c c√¢u h·ªèi tr·∫Øc nghi·ªám ƒëa d·∫°ng v√† t√πy ch·ªânh.</p>
                            <span class="mt-6 inline-flex items-center gap-2 text-xs font-semibold text-emerald-600 group-hover:text-emerald-800">V√†o ph√≤ng quiz <i class="fa-solid fa-arrow-right text-[0.65rem]"></i></span>
                        </a>

                        <a href="{{ url_for('learning.course_learning.course_learning_dashboard') }}" class="group bg-amber-50 border border-amber-100 rounded-2xl p-6 hover:border-amber-200 transition-all">
                            <div class="flex items-center justify-between">
                                <span class="text-lg font-semibold text-amber-700">Kh√≥a h·ªçc</span>
                                <i class="fa-solid fa-graduation-cap text-amber-500"></i>
                            </div>
                            <p class="mt-3 text-sm text-amber-600">Theo d√µi l·ªô tr√¨nh h·ªçc t·∫≠p c√≥ c·∫•u tr√∫c r√µ r√†ng.</p>
                            <span class="mt-6 inline-flex items-center gap-2 text-xs font-semibold text-amber-600 group-hover:text-amber-800">Ti·∫øp t·ª•c b√†i h·ªçc <i class="fa-solid fa-arrow-right text-[0.65rem]"></i></span>
                        </a>

                        <a href="{{ url_for('content_management.content_dashboard') }}" class="group bg-slate-50 border border-slate-200 rounded-2xl p-6 hover:border-slate-300 transition-all">
                            <div class="flex items-center justify-between">
                                <span class="text-lg font-semibold text-slate-700">Qu·∫£n l√Ω n·ªôi dung</span>
                                <i class="fa-solid fa-book text-slate-500"></i>
                            </div>
                            <p class="mt-3 text-sm text-slate-600">T·∫°o, ch·ªânh s·ª≠a v√† qu·∫£n l√Ω t√†i nguy√™n h·ªçc t·∫≠p c·ªßa ri√™ng b·∫°n.</p>
                            <span class="mt-6 inline-flex items-center gap-2 text-xs font-semibold text-slate-600 group-hover:text-slate-800">M·ªü trang qu·∫£n tr·ªã <i class="fa-solid fa-arrow-right text-[0.65rem]"></i></span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-3xl shadow-sm border border-slate-100 p-8 h-fit">
                <p class="text-xs font-semibold uppercase tracking-[0.35em] text-slate-400">B·∫£ng x·∫øp h·∫°ng</p>
                <h3 class="mt-2 text-xl font-semibold text-slate-900">Top ƒëi·ªÉm th∆∞·ªüng th√†nh vi√™n</h3>
                <p class="mt-2 text-sm text-slate-500">C√πng thi ƒëua ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu ph·∫ßn th∆∞·ªüng h∆°n.</p>

                <ul class="mt-6 space-y-3">
                    {% for entry in leaderboard %}
                        <li class="flex items-center justify-between gap-4 rounded-2xl border border-slate-100 px-4 py-3 {% if entry.is_current_user %}bg-indigo-50 border-indigo-100{% else %}bg-white{% endif %}">
                            <div class="flex items-center gap-4">
                                <span class="w-8 h-8 rounded-full flex items-center justify-center font-semibold text-sm {% if entry.rank == 1 %}bg-amber-100 text-amber-600{% elif entry.rank == 2 %}bg-slate-100 text-slate-600{% elif entry.rank == 3 %}bg-orange-100 text-orange-600{% else %}bg-slate-100 text-slate-500{% endif %}">{{ entry.rank }}</span>
                                <div>
                                    <p class="text-sm font-semibold text-slate-800">{{ entry.username }}</p>
                                    {% if entry.is_current_user %}
                                        <p class="text-xs text-indigo-600 font-semibold">B·∫°n ƒëang ·ªü v·ªã tr√≠ n√†y</p>
                                    {% endif %}
                                </div>
                            </div>
                            <span class="text-sm font-semibold text-slate-700">{{ "{:,}".format(entry.score) }} ƒëi·ªÉm</span>
                        </li>
                    {% else %}
                        <li class="text-sm text-slate-500">Ch∆∞a c√≥ d·ªØ li·ªáu x·∫øp h·∫°ng. H√£y t√≠ch c·ª±c h·ªçc t·∫≠p ƒë·ªÉ d·∫´n ƒë·∫ßu b·∫£ng nh√©!</li>
                    {% endfor %}
                </ul>
            </div>
        </section>
    </div>
</div>
{% endblock %}
