{# ================= MOBILE APP INTERFACE - MODERN FLAT DESIGN ================= #}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<div class="lg:hidden fixed inset-0 z-[100] flex flex-col h-[100dvh] w-full safe-area-inset-bottom mobile-dashboard"
    style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">

    {# === CLEAN BACKGROUND === #}
    <div class="fixed inset-0 bg-gradient-to-b from-slate-50 to-slate-100 -z-10"></div>

    {# === 1. TOP NAVBAR - MODERN === #}
    <div
        class="flex-shrink-0 bg-white px-5 py-4 flex items-center justify-between border-b border-slate-200 relative z-20">
        <div class="flex items-center gap-3 animate-slide-in-left">
            <!-- BRAND TEXT ONLY -->
            <div>
                <h1 class="text-base font-black text-slate-900 tracking-tight leading-none mb-0.5">
                    MindStack</h1>
                <p class="text-xs text-slate-500 font-medium">Xin ch√†o, {{ current_user.username }}</p>
            </div>
        </div>
        <div class="flex items-center gap-3 animate-slide-in-right">
            <div class="flex items-center gap-2 bg-gradient-to-r from-amber-500 to-orange-500 px-3 py-2 rounded-xl">
                <i class="fa-solid fa-fire text-white text-sm"></i>
                <span class="text-sm font-bold text-white">{{ score_cards[3].value if score_cards|length > 3 else 0
                    }}</span>
            </div>
            <a href="{{ url_for('user_profile.view_profile') }}"
                class="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center text-slate-600 hover:bg-indigo-100 hover:text-indigo-600 transition-colors">
                <i class="fa-solid fa-user text-base"></i>
            </a>
        </div>
    </div>

    {# === 2. MAIN CONTENT AREA === #}
    <div class="flex-grow overflow-y-auto overflow-x-hidden p-5 space-y-5 pb-24 relative">

        {# Motivation Card - Modern #}
        {% if motivation_message %}
        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-3xl p-5 flex items-start gap-4 active:scale-[0.98] transition-transform cursor-pointer animate-fade-in-up"
            onclick="this.querySelector('p').classList.toggle('line-clamp-2')" style="animation-delay: 0.1s">
            <div
                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white flex-shrink-0">
                <i class="fa-solid fa-lightbulb text-xl"></i>
            </div>
            <div class="flex-grow pt-1">
                <h4 class="text-xs font-bold text-blue-700 uppercase tracking-wide mb-2 flex items-center gap-1.5">
                    <span>üí°</span>
                    <span>Focus Today</span>
                </h4>
                <p class="text-sm text-slate-700 font-medium line-clamp-2 leading-relaxed">
                    {{ motivation_message }}
                </p>
            </div>
        </div>
        {% endif %}

        <!-- Stats Cards - Modern -->
        <div class="grid grid-cols-2 gap-4">
            <!-- Points Card -->
            <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl p-6 text-white animate-fade-in-up"
                style="animation-delay: 0.2s">
                <div class="flex items-center gap-2 mb-3">
                    <div class="w-9 h-9 rounded-xl bg-white/20 flex items-center justify-center">
                        <i class="fa-solid fa-star text-yellow-300 text-base"></i>
                    </div>
                    <p class="text-xs font-bold uppercase tracking-wider opacity-90">ƒêi·ªÉm th∆∞·ªüng</p>
                </div>
                <p class="text-4xl font-black tracking-tight">{{ "{:,}".format(score_cards[0].value) if score_cards else
                    0 }}</p>
                <div class="mt-4 h-2 bg-white/20 rounded-full overflow-hidden">
                    <div class="h-full bg-white/50 rounded-full transition-all duration-1000" style="width: 75%"></div>
                </div>
            </div>

            <!-- Learned Card -->
            <div class="bg-white border border-slate-200 rounded-3xl p-6 flex flex-col justify-center animate-fade-in-up"
                style="animation-delay: 0.3s">
                <div class="flex items-center gap-2 mb-3">
                    <div
                        class="w-9 h-9 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center">
                        <i class="fa-solid fa-book-open text-white text-sm"></i>
                    </div>
                    <p class="text-xs font-bold uppercase tracking-wider text-slate-500">ƒê√£ h·ªçc</p>
                </div>
                <p class="text-4xl font-black text-slate-900 tracking-tight">
                    {{ "{:,}".format(score_cards[1].value) if score_cards|length > 1 else 0 }}
                </p>
            </div>
        </div>

        <!-- Focus/Goal Section - Modern -->
        <div>
            <div class="flex items-center justify-between mb-4 px-1">
                <h3 class="text-sm font-bold text-slate-800 tracking-tight flex items-center gap-2">
                    <span>üéØ</span>
                    <span>Ti√™u ƒëi·ªÉm h√¥m nay</span>
                </h3>
            </div>
            {% if goal_progress %}
            {% set main_goal = goal_progress[0] %}
            <div class="bg-white border border-slate-200 p-6 rounded-3xl animate-fade-in-up"
                style="animation-delay: 0.4s">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-2xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center">
                            <i class="fa-solid fa-bullseye text-white text-base"></i>
                        </div>
                        <span class="text-base font-bold text-slate-900">{{ main_goal.title }}</span>
                    </div>
                    <span class="text-lg font-black text-purple-600">{{ main_goal.percent }}%</span>
                </div>
                <div class="w-full bg-slate-100 rounded-full h-3 mb-4 overflow-hidden">
                    <div class="bg-gradient-to-r from-purple-600 to-pink-600 h-3 rounded-full transition-all duration-1000"
                        style="width: {{ main_goal.percent }}%"></div>
                </div>
                <p class="text-sm text-slate-600 font-medium">
                    ‚ú® ƒê√£ ho√†n th√†nh <span class="font-black text-purple-600">{{ main_goal.current_value }}</span>/{{
                    main_goal.target_value }} {{ main_goal.unit }} h√¥m nay
                </p>
            </div>
            {% else %}
            <a href="{{ url_for('content_management.content_dashboard') }}"
                class="block bg-gradient-to-br from-slate-800 to-slate-900 text-white p-6 rounded-3xl animate-fade-in-up hover:scale-[1.02] transition-transform"
                style="animation-delay: 0.4s">
                <div class="flex items-center gap-3 mb-3">
                    <div
                        class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center">
                        <i class="fa-solid fa-pen-nib text-white text-xl"></i>
                    </div>
                    <h4 class="font-black text-lg">Studio S√°ng T·∫°o</h4>
                </div>
                <p class="text-sm text-slate-300 font-medium leading-relaxed">
                    B·∫Øt ƒë·∫ßu t·∫°o b·ªô th·∫ª v√† n·ªôi dung h·ªçc t·∫≠p m·ªõi ngay b√¢y gi·ªù! ‚ú®
                </p>
            </a>
            {% endif %}
        </div>
    </div>

    {# === 3. BOTTOM TAB BAR - MODERN WITH ARC MENU === #}
    <div class="flex-shrink-0 relative z-30" style="padding-bottom: env(safe-area-inset-bottom, 8px);">
        <!-- Arc Menu Overlay with Blur -->
        <div id="arcMenuOverlay"
            class="fixed inset-0 bg-black/30 backdrop-blur-sm opacity-0 pointer-events-none transition-all duration-300 z-40">
        </div>

        <!-- Learning Menu - Vertical Stack -->
        <div id="arcMenu"
            class="fixed bottom-28 left-1/2 opacity-0 pointer-events-none transition-all duration-300 z-50"
            style="transform: translateX(-50%);">
            <div class="flex flex-col items-center gap-3">
                <!-- Quiz -->
                <a href="{{ url_for('learning.quiz_learning.quiz_learning_dashboard') }}"
                    class="flex items-center gap-4 bg-emerald-500 text-white px-6 py-4 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all arc-item w-[240px]">
                    <div class="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-question-circle text-3xl"></i>
                    </div>
                    <div class="flex-grow text-left">
                        <p class="text-base font-black">Quiz</p>
                        <p class="text-xs opacity-90 font-medium">Luy·ªán t·∫≠p c√¢u h·ªèi</p>
                    </div>
                </a>

                <!-- Flashcard -->
                <a href="{{ url_for('learning.flashcard.dashboard') }}"
                    class="flex items-center gap-4 bg-blue-500 text-white px-6 py-4 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all arc-item w-[240px]">
                    <div class="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-clone text-3xl"></i>
                    </div>
                    <div class="flex-grow text-left">
                        <p class="text-base font-black">Flashcard</p>
                        <p class="text-xs opacity-90 font-medium">√în t·∫≠p th·∫ª nh·ªõ</p>
                    </div>
                </a>

                <!-- Course -->
                <a href="{{ url_for('learning.course_learning.course_learning_dashboard') }}"
                    class="flex items-center gap-4 bg-amber-500 text-white px-6 py-4 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-105 transition-all arc-item w-[240px]">
                    <div class="w-14 h-14 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
                        <i class="fa-solid fa-graduation-cap text-3xl"></i>
                    </div>
                    <div class="flex-grow text-left">
                        <p class="text-base font-black">Course</p>
                        <p class="text-xs opacity-90 font-medium">L·ªô tr√¨nh h·ªçc t·∫≠p</p>
                    </div>
                </a>
            </div>
        </div>

        <!-- Bottom Navigation Bar -->
        <div class="bg-white border-t border-slate-200">
            <div class="flex justify-between items-end px-5 py-3">
                <!-- 1. Home -->
                <a href="#" class="flex flex-col items-center gap-1 transition-all hover:scale-105">
                    <div class="w-11 h-11 rounded-2xl bg-indigo-600 flex items-center justify-center shadow-sm">
                        <i class="fa-solid fa-house text-white text-lg"></i>
                    </div>
                    <span class="text-[10px] font-bold text-indigo-600">Home</span>
                </a>

                <!-- 2. Goals -->
                <a href="{{ url_for('goals.manage_goals') }}"
                    class="flex flex-col items-center gap-1 text-slate-400 hover:text-amber-500 transition-all hover:scale-105 pb-1">
                    <div class="w-10 h-10 flex items-center justify-center">
                        <i class="fa-solid fa-bullseye text-2xl"></i>
                    </div>
                    <span class="text-[10px] font-bold">M·ª•c ti√™u</span>
                </a>

                <!-- 3. Learn (Center - Elevated Circle) -->
                <button id="learnButton"
                    class="flex flex-col items-center -mt-7 transition-all hover:scale-105 relative">
                    <div
                        class="w-[68px] h-[68px] rounded-full bg-gradient-to-br from-purple-600 to-purple-700 flex items-center justify-center transition-transform active:scale-95 shadow-xl border-[5px] border-white">
                        <i id="learnIcon" class="fa-solid fa-brain text-white text-[28px] transition-transform"></i>
                    </div>
                    <span class="text-[10px] font-bold text-purple-600 mt-1.5">H·ªçc</span>
                </button>

                <!-- 4. Stats -->
                <a href="{{ url_for('stats.dashboard') }}"
                    class="flex flex-col items-center gap-1 text-slate-400 hover:text-cyan-500 transition-all hover:scale-105 pb-1">
                    <div class="w-10 h-10 flex items-center justify-center">
                        <i class="fa-solid fa-chart-pie text-2xl"></i>
                    </div>
                    <span class="text-[10px] font-bold">Th·ªëng k√™</span>
                </a>

                <!-- 5. Profile -->
                <a href="{{ url_for('user_profile.view_profile') }}"
                    class="flex flex-col items-center gap-1 text-slate-400 hover:text-rose-500 transition-all hover:scale-105 pb-1">
                    <div class="w-10 h-10 flex items-center justify-center">
                        <i class="fa-solid fa-user text-2xl"></i>
                    </div>
                    <span class="text-[10px] font-bold">C√° nh√¢n</span>
                </a>
            </div>
        </div>
    </div>

</div>

<script>
    // Arc Menu Toggle
    const learnButton = document.getElementById('learnButton');
    const arcMenu = document.getElementById('arcMenu');
    const arcMenuOverlay = document.getElementById('arcMenuOverlay');
    const learnIcon = document.getElementById('learnIcon');
    let isArcMenuOpen = false;

    function toggleArcMenu() {
        isArcMenuOpen = !isArcMenuOpen;

        if (isArcMenuOpen) {
            arcMenu.classList.remove('opacity-0', 'pointer-events-none');
            arcMenu.classList.add('opacity-100', 'pointer-events-auto');
            arcMenuOverlay.classList.remove('opacity-0', 'pointer-events-none');
            arcMenuOverlay.classList.add('opacity-100', 'pointer-events-auto');
            learnIcon.style.transform = 'rotate(180deg)';

            const arcItems = document.querySelectorAll('.arc-item');
            arcItems.forEach((item, index) => {
                setTimeout(() => {
                    item.style.transform = 'scale(1)';
                    item.style.opacity = '1';
                }, index * 50);
            });
        } else {
            arcMenu.classList.add('opacity-0', 'pointer-events-none');
            arcMenu.classList.remove('opacity-100', 'pointer-events-auto');
            arcMenuOverlay.classList.add('opacity-0', 'pointer-events-none');
            arcMenuOverlay.classList.remove('opacity-100', 'pointer-events-auto');
            learnIcon.style.transform = 'rotate(0deg)';

            const arcItems = document.querySelectorAll('.arc-item');
            arcItems.forEach(item => {
                item.style.transform = 'scale(0)';
                item.style.opacity = '0';
            });
        }
    }

    learnButton.addEventListener('click', toggleArcMenu);
    arcMenuOverlay.addEventListener('click', toggleArcMenu);

    document.addEventListener('DOMContentLoaded', () => {
        const arcItems = document.querySelectorAll('.arc-item');
        arcItems.forEach(item => {
            item.style.transform = 'scale(0)';
            item.style.opacity = '0';
        });
    });
</script>

<style>
    /* Animations */
    @keyframes slide-in-left {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes slide-in-right {
        from {
            opacity: 0;
            transform: translateX(20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes fade-in-up {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-slide-in-left {
        animation: slide-in-left 0.5s ease-out;
    }

    .animate-slide-in-right {
        animation: slide-in-right 0.5s ease-out;
    }

    .animate-fade-in-up {
        animation: fade-in-up 0.6s ease-out backwards;
    }

    /* Smooth scrolling */
    .mobile-dashboard {
        scroll-behavior: smooth;
    }

    /* Line clamp utility */
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>