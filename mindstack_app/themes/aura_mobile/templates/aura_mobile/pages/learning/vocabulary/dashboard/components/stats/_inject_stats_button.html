<script>
    // Add stats button to header
    document.addEventListener('DOMContentLoaded', function () {
        const header = document.querySelector('#step-detail .step-header-left');
        if (!header) return;

        // Check if button already exists
        if (header.querySelector('.js-open-container-stats')) return;

        // Create stats button
        const statsBtn = document.createElement('button');
        statsBtn.className = 'step-stats-btn js-open-container-stats';
        statsBtn.title = 'Xem thống kê tổng hợp';
        statsBtn.innerHTML = '<i class="fas fa-chart-bar"></i>';

        // Add CSS for the button
        const style = document.createElement('style');
        style.textContent = `
        .step-stats-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        .step-stats-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .step-stats-btn:active {
            transform: translateY(0);
        }
    `;
        document.head.appendChild(style);

        // Insert before Settings button if exists, otherwise Home button
        const settingsBtn = header.querySelector('.js-open-flashcard-settings');
        const homeBtn = header.querySelector('.step-home-btn');
        
        if (settingsBtn) {
            header.insertBefore(statsBtn, settingsBtn);
        } else if (homeBtn) {
            header.insertBefore(statsBtn, homeBtn);
        } else {
            header.appendChild(statsBtn);
        }

        // Add click handler
        statsBtn.addEventListener('click', function () {
            const pathParts = window.location.pathname.split('/');
            const containerId = pathParts[pathParts.length - 1];

            if (/^\d+$/.test(containerId)) {
                const titleEl = document.querySelector('.js-detail-title-full');
                const containerName = titleEl ? titleEl.textContent.trim() : 'Vocabulary Set';
                openContainerStatsModal(containerId, containerName);
            }
        });
    });
</script>
