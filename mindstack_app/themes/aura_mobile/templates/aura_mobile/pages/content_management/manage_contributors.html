{# File: mindstack_app/templates/v3/pages/content_management/manage_contributors.html #}
{% set _v = template_version %}
{% extends _v ~ '/base.html' %}

{% block title %}Quản lý quyền truy cập - {{ container.title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex items-center mb-6">
        <a href="{{ url_for('content_management.content_dashboard') }}"
            class="text-indigo-500 hover:text-indigo-700 mr-3 transition-colors" title="Quay lại Dashboard">
            <i class="fas fa-arrow-left text-xl"></i>
        </a>
        <h1 class="text-2xl font-bold text-slate-800">
            Quản lý quyền truy cập cho: <span class="text-indigo-600">{{ container.title }}</span>
        </h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Cột thêm người mới -->
        <div class="lg:col-span-1">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-user-plus text-indigo-500"></i>
                    Thêm người đóng góp
                </h2>
                <form method="POST"
                    action="{{ url_for('content_management.manage_contributors', container_id=container.container_id) }}"
                    class="space-y-4">
                    {{ form.hidden_tag() }}
                    <div>
                        <label for="{{ form.username.id }}" class="block text-sm font-semibold text-slate-700 mb-1">{{
                            form.username.label }}</label>
                        {{ form.username(class="block w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl
                        focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-sm",
                        placeholder="Nhập tên người dùng...", list="username-suggestions") }}
                        <datalist id="username-suggestions">
                            {% for username in username_suggestions %}
                            <option value="{{ username }}"></option>
                            {% endfor %}
                        </datalist>
                        {% if form.username.errors %}
                        <ul class="text-red-500 text-xs mt-1 space-y-1">
                            {% for error in form.username.errors %}
                            <li class="flex items-center gap-1"><i class="fas fa-exclamation-circle"></i> {{ error }}
                            </li>
                            {% endfor %}
                        </ul>
                        {% endif %}
                    </div>
                    <div>
                        <label for="{{ form.permission_level.id }}"
                            class="block text-sm font-semibold text-slate-700 mb-1">{{ form.permission_level.label
                            }}</label>
                        {{ form.permission_level(class="block w-full px-4 py-2 bg-slate-50 border border-slate-200
                        rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-sm")
                        }}
                    </div>
                    <button type="submit"
                        class="w-full bg-indigo-600 text-white px-4 py-2.5 rounded-xl font-bold hover:bg-indigo-700 active:scale-[0.98] transition-all shadow-md flex items-center justify-center gap-2">
                        <i class="fas fa-plus"></i>
                        Thêm ngay
                    </button>
                </form>
            </div>
        </div>

        <!-- Cột danh sách người đã có quyền -->
        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-users text-indigo-500"></i>
                    Danh sách hiện tại
                </h2>
                <div class="overflow-x-auto -mx-6 sm:mx-0">
                    <table class="min-w-full divide-y divide-slate-100">
                        <thead>
                            <tr class="bg-slate-50">
                                <th scope="col"
                                    class="px-6 py-3 text-left text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                    Tên người dùng</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-[10px] font-bold text-slate-400 uppercase tracking-wider hidden sm:table-cell">
                                    Email</th>
                                <th scope="col"
                                    class="px-6 py-3 text-left text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                    Quyền</th>
                                <th scope="col"
                                    class="px-6 py-3 text-right text-[10px] font-bold text-slate-400 uppercase tracking-wider">
                                    Hành động</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-50 bg-white">
                            <!-- Người tạo -->
                            <tr class="hover:bg-slate-50/50 transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-slate-800">{{ container.creator.username }}</div>
                                    <div class="text-xs text-slate-400 sm:hidden">{{ container.creator.email }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 hidden sm:table-cell">{{
                                    container.creator.email }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span
                                        class="px-2.5 py-0.5 inline-flex text-xs font-bold rounded-full bg-emerald-50 text-emerald-600 border border-emerald-100">
                                        Người tạo
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"></td>
                            </tr>
                            <!-- Danh sách người đóng góp -->
                            {% for contributor, user in contributors %}
                            <tr class="hover:bg-slate-50/50 transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-slate-800">{{ user.username }}</div>
                                    <div class="text-xs text-slate-400 sm:hidden">{{ user.email }}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500 hidden sm:table-cell">{{
                                    user.email }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span
                                        class="px-2.5 py-0.5 inline-flex text-xs font-bold rounded-full bg-indigo-50 text-indigo-600 border border-indigo-100">
                                        {{ contributor.permission_level|capitalize }}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                                    <form method="POST"
                                        action="{{ url_for('content_management.manage_contributors', container_id=container.container_id) }}"
                                        onsubmit="return confirm('Bạn có chắc chắn muốn xóa quyền của người dùng này?');">
                                        <input type="hidden" name="remove_contributor_id" value="{{ user.user_id }}">
                                        <button type="submit"
                                            class="text-rose-500 hover:text-rose-700 font-bold transition-colors flex items-center gap-1 ml-auto">
                                            <i class="fas fa-trash-alt text-xs"></i>
                                            Xóa
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if not contributors %}
                <div class="text-center py-12">
                    <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-users-slash text-slate-300 text-2xl"></i>
                    </div>
                    <p class="text-slate-400 font-medium">Chưa có người đóng góp nào.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
