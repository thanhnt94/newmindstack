{# File: mindstack_app/templates/aura_mobile/pages/content_management/_index_mobile.html #}
{% from _v ~ '/includes/components/dashboard_header.html' import render_dashboard_header, mobile_footer %}

<div class="flex flex-col h-screen w-full mobile-dashboard bg-slate-50"
    style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">

    {# === CLEAN BACKGROUND === #}
    <div class="fixed inset-0 bg-gradient-to-b from-slate-50 to-slate-100 -z-10"></div>

    {# === FIXED TOP HEADER #}
    {% call render_dashboard_header(
    title='Quản lý nội dung',
    subtitle='Nội dung của tôi',
    back_url=url_for('dashboard.dashboard'),
    show_home=True
    ) %}
    <div class="flex items-center gap-2">
        {# === SEARCH TOGGLE BUTTON === #}
        <button type="button" id="mobile-search-toggle-btn"
            class="w-9 h-9 rounded-xl bg-slate-200 flex items-center justify-center text-slate-600 hover:bg-slate-300 active:scale-95 transition-all"
            title="Tìm kiếm">
            <i class="fa-solid fa-magnifying-glass text-sm"></i>
        </button>

        {# === DYNAMIC ADD BUTTON === #}
        <button type="button" id="mobile-add-btn"
            class="open-modal-btn w-9 h-9 rounded-xl bg-gradient-to-br from-indigo-500 to-violet-600 flex items-center justify-center text-white shadow-md active:scale-95 transition-all"
            data-modal-url="" title="Thêm mới">
            <i class="fa-solid fa-plus text-sm"></i>
        </button>
    </div>
    {% endcall %}

    {# === COLLAPSIBLE SEARCH BAR === #}
    <div id="mobile-search-bar" class="hidden px-5 py-3 bg-white border-b border-slate-200">
        <div id="mobile-search-form-container">
            {# Search form will be injected here by JavaScript based on active tab #}
            <div class="text-sm text-slate-400 text-center py-2">Đang tải form tìm kiếm...</div>
        </div>
    </div>

    {# === SCROLLABLE MAIN CONTENT === #}
    <div class="flex-grow overflow-y-auto overflow-x-hidden pb-16 no-scrollbar">
        <div id="mobile-tab-content" class="px-5 py-4 min-h-[300px]">
            <div class="flex flex-col items-center justify-center gap-4 text-slate-400 py-12">
                <div class="w-16 h-16 rounded-full bg-indigo-50 flex items-center justify-center">
                    <i class="fa-solid fa-rotate animate-spin text-indigo-400 text-2xl"></i>
                </div>
                <p class="text-sm font-medium text-slate-500">Đang tải nội dung...</p>
            </div>
        </div>
    </div>

    {# === FIXED PAGINATION BAR === #}
    <div id="mobile-fixed-pagination-bar"
        class="fixed bottom-[60px] left-0 right-0 z-[190] bg-white/95 backdrop-blur-sm border-t border-slate-100 px-2 py-2 hidden shadow-[0_-2px_10px_rgba(0,0,0,0.02)]">
        <div id="mobile-fixed-pagination-slot" class="w-full flex justify-center items-center">
            {# JS will move pagination here #}
        </div>
    </div>

    {# === FIXED BOTTOM TAB BAR === #}
    {% call mobile_footer() %}
    <div class="flex w-full h-[50px] bg-slate-100 rounded-2xl p-1 overflow-hidden relative border border-slate-200">
        <button id="mobile-tab-flashcards" data-target="flashcards"
            class="mobile-tab-btn flex-1 flex items-center justify-center gap-2 py-2 text-xs font-bold transition-all duration-300 rounded-xl relative z-10"
            aria-selected="false">
            <i class="fa-solid fa-clone"></i>
            <span>Vocab</span>
        </button>
        <button id="mobile-tab-quizzes" data-target="quizzes"
            class="mobile-tab-btn flex-1 flex items-center justify-center gap-2 py-2 text-xs font-bold transition-all duration-300 rounded-xl relative z-10"
            aria-selected="false">
            <i class="fa-solid fa-circle-question"></i>
            <span>Quiz</span>
        </button>
        <button id="mobile-tab-courses" data-target="courses"
            class="mobile-tab-btn flex-1 flex items-center justify-center gap-2 py-2 text-xs font-bold transition-all duration-300 rounded-xl relative z-10"
            aria-selected="false">
            <i class="fa-solid fa-book"></i>
            <span>Course</span>
        </button>
    </div>
    {% endcall %}
</div>

<style>
    /* Tab button states: Revert to Gradient Style */
    .mobile-tab-btn {
        background: transparent;
        color: #64748b;
        border: none;
        border-radius: 0;
    }

    .mobile-tab-btn[aria-selected="true"] {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        box-shadow: 0 -4px 15px -3px rgba(99, 102, 241, 0.3);
    }

    .mobile-tab-btn:hover:not([aria-selected="true"]) {
        background: #f1f5f9;
        color: #475569;
    }

    /* Hide scrollbar */
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* Ensure pagination controls fit in fixed bar */
    #mobile-fixed-pagination-slot .pagination,
    #mobile-fixed-pagination-slot>div {
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        box-shadow: none !important;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 0.5rem;
    }

    /* Mobile-First Layout - Applied everywhere */
    body>header,
    body>nav,
    body>footer {
        display: none !important;
    }

    main.app-container {
        padding: 0 !important;
        margin: 0 !important;
        max-width: 100% !important;
    }
</style>

<script src="{{ url_for('theme_assets', theme_name='aura_mobile', filename='js/cms.js') }}"></script>
<script>
    (function () {
        MindStackCMS.initMobile({
            urls: {
                courses: "{{ url_for('content_management.list_containers', container_type='COURSE') }}",
                flashcards: "{{ url_for('content_management.list_containers', container_type='FLASHCARD_SET') }}",
                quizzes: "{{ url_for('content_management.list_containers', container_type='QUIZ_SET') }}"
            },
            addUrls: {
                courses: "{{ url_for('content_management.add_container', container_type='COURSE') }}",
                flashcards: "{{ url_for('content_management.add_container', container_type='FLASHCARD_SET') }}",
                quizzes: "{{ url_for('content_management.add_container', container_type='QUIZ_SET') }}"
            }
        });
    })();
</script>
