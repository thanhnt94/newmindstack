{% macro render_learning_header(title_selector, badge_text, badge_icon, theme_gradient, badge_text_color='text-white',
badge_icon_color='text-yellow-300', exit_func=None, show_score=False, score_selector='js-header-score', score_value='0',
left_btn_func='history.back()', left_btn_icon='fa-solid fa-chevron-left', stats_content=None, hide_second_row=False,
hide_left_btn=False, hide_right_btns=False, align_left=False, counter_selector=None) %}
<div class="fc-header flex-col items-stretch !p-0 shadow-md z-50 relative">

    {# --- Row 1: Navigation & Title (Themed) --- #}
    <div id="learning-header-container"
        class="relative flex items-center gap-2 pl-4 pr-1.5 py-2.5 {{ theme_gradient }} text-white shadow-sm transition-all duration-500">

        {# Left Button (Back / Toggle) #}
        {% if not hide_left_btn %}
        <button
            class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition-colors backdrop-blur-sm z-10 relative flex-shrink-0"
            onclick="{{ left_btn_func }}">
            <i id="header-toggle-icon" class="{{ left_btn_icon }} text-sm transition-all duration-300"></i>
        </button>
        {% endif %}

        {# Header Content (Title vs Stats) #}
        <div id="header-center-container"
            class="{% if align_left %} flex-1 min-w-0 {% else %} absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-[60%] pointer-events-none {% endif %} h-full flex items-center {% if align_left %} justify-start {% else %} justify-center {% endif %} transition-all duration-300 overflow-hidden">

            {# View 1: Title (Default) - Enhanced Premium Typography #}
            <div id="header-title-view"
                class="flex flex-col {% if align_left %} items-start {% else %} items-center justify-center {% endif %} w-full transition-all duration-300 opacity-100 scale-100 py-1 min-w-0 overflow-hidden">
                <div class="flex items-center gap-2 opacity-90 mb-1.5 pointer-events-auto">
                    <i class="{{ badge_icon }} text-[10px] {{ badge_icon_color }}"></i>
                    <span
                        class="text-[9px] font-black uppercase tracking-[0.15em] {{ badge_text_color }} cursor-pointer">
                        {{ badge_text }}
                    </span>
                    {% if counter_selector %}
                    <span
                        class="text-[9px] font-black {{ counter_selector }} opacity-70 bg-white/20 px-1.5 py-0.5 rounded-md ml-0.5">
                        1
                    </span>
                    {% endif %}
                </div>
                <span
                    class="font-extrabold text-white w-full {% if align_left %} text-left {% else %} text-center {% endif %} {{ title_selector }} leading-snug pointer-events-auto tracking-tight truncate whitespace-nowrap block overflow-hidden"
                    style="font-size: 15px;" title="MindStack">
                    ...
                </span>
            </div>

            {# View 2: Stats (Hidden) #}
            {% if stats_content %}
            <div id="header-stats-view"
                class="hidden flex items-center justify-center gap-3 w-full transition-all duration-300 opacity-0 scale-95 pointer-events-auto">
                {{ stats_content|safe }}
            </div>
            {% endif %}
        </div>

        {# Right Actions #}
        <div id="header-right-actions"
            class="flex items-center gap-1 z-10 relative transition-all duration-300 flex-shrink-0">
            {# Score Display #}
            {% if show_score %}
            <div
                class="px-2 py-1 rounded-full bg-white/20 backdrop-blur-md border border-white/20 flex items-center gap-1.5 animate-fadeIn shadow-inner">
                <i class="fas fa-gem text-[11px] text-yellow-300 drop-shadow-sm"></i>
                <span class="{{ score_selector }} text-xs font-black text-white font-mono">{{ score_value }}</span>
            </div>
            {% endif %}

            {# Exit Button #}
            {% if exit_func and not hide_right_btns %}
            <button onclick="{{ exit_func }}"
                class="w-9 h-9 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all backdrop-blur-md text-red-100 hover:text-white border border-white/5 active:scale-90"
                title="ThoÃ¡t">
                <i class="fa-solid fa-right-from-bracket text-base"></i>
            </button>
            {% endif %}

            {# Home Button #}
            {% if not hide_right_btns %}
            <a href="/"
                class="w-9 h-9 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all backdrop-blur-md text-white border border-white/5 active:scale-90">
                <i class="fa-solid fa-house text-base"></i>
            </a>
            {% endif %}
        </div>
    </div>

    {# --- Row 2: Stats & Tools (White) --- #}
    {% if not hide_second_row %}
    <div class="bg-white border-b border-slate-200 shadow-sm relative z-10">
        <div class="flex items-center justify-between px-4 py-2.5">
            {{ caller() }}
        </div>
    </div>
    {% endif %}

    {# Progress Line Slot (Optional) #}
    {% if kwargs.get('show_progress_line') %}
    <div class="h-1 bg-black/10 w-full overflow-hidden relative">
        <div class="h-full {{ kwargs.get('progress_color', 'bg-blue-500') }} {{ kwargs.get('progress_selector', '') }} transition-all duration-500 rounded-r-full shadow-[0_0_10px_rgba(255,255,255,0.5)]"
            style="width: 0%"></div>
    </div>
    {% endif %}

</div>
{% endmacro %}