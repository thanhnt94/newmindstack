<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>

<style>
    .markdown-body {
        color: #1f2937;
        font-size: 0.95rem;
        line-height: 1.6;
        word-wrap: break-word;
        white-space: normal !important;
    }

    .markdown-body p {
        margin-bottom: 0.75rem;
    }

    .markdown-body ul,
    .markdown-body ol {
        margin: 0.75rem 0 0.75rem 1.25rem;
        padding-left: 0.25rem;
    }

    .markdown-body ul {
        list-style-type: disc !important;
    }

    .markdown-body ol {
        list-style-type: decimal !important;
    }

    .markdown-body li {
        margin-bottom: 0.25rem;
        display: list-item !important;
    }

    .markdown-body h1,
    .markdown-body h2,
    .markdown-body h3,
    .markdown-body h4 {
        color: #111827;
        font-weight: 700;
        margin-top: 1rem;
        margin-bottom: 0.5rem;
    }

    .markdown-body strong,
    .markdown-body b {
        font-weight: 700;
        color: #111827;
    }

    /* Override any interfering styles */
    .markdown-body * {
        text-align: left !important;
    }
</style>
<script>
    (function () {
        const fallbackFormat = (text) => {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML.replace(/\r?\n/g, '<br>');
        };

        window.renderMarkdown = function (text, options = {}) {
            if (!text) return '';
            const value = String(text);

            try {
                // Better marked detection for v9+
                let parser = null;
                if (window.marked) {
                    if (typeof window.marked === 'function') parser = window.marked;
                    else if (typeof window.marked.parse === 'function') parser = window.marked.parse.bind(window.marked);
                    else if (window.marked.marked && typeof window.marked.marked.parse === 'function') parser = window.marked.marked.parse.bind(window.marked.marked);
                }

                if (parser) {
                    const rawHtml = parser(value);
                    return window.DOMPurify ? window.DOMPurify.sanitize(rawHtml) : rawHtml;
                }
            } catch (err) {
                console.warn('Marked error:', err);
            }

            return fallbackFormat(value);
        };

        window.applyMarkdownToElement = function (element, text) {
            if (!element) return;
            element.innerHTML = window.renderMarkdown(text);
            element.classList.add('markdown-body');
            element.style.whiteSpace = 'normal';
        };
    })();
</script>
