<table class="min-w-full divide-y divide-slate-200" id="flashcard-tasks-table">
    <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
        <tr>
            <th class="px-6 py-3 text-left font-semibold">Task Name</th>
            <th class="px-6 py-3 text-left font-semibold">Status</th>
            <th class="px-6 py-3 text-left font-semibold">Progress</th>
            <th class="px-6 py-3 text-left font-semibold">Message</th>
            <th class="px-6 py-3 text-left font-semibold">Enabled</th>
            <th class="px-6 py-3 text-left font-semibold">Actions</th>
        </tr>
    </thead>
    <tbody class="divide-y divide-slate-100 text-sm">
        {% for task in tasks %}
        {% if task.task_name in ['generate_audio_cache', 'clean_audio_cache'] %}
        <tr class="hover:bg-slate-50 task-row" data-task-id="{{ task.task_id }}">
            <td class="px-6 py-4 font-medium text-slate-900">
                {% if task.task_name == 'generate_audio_cache' %}
                Generate Audio Cache
                {% elif task.task_name == 'clean_audio_cache' %}
                Clean Orphan Audio
                {% else %}
                {{ task.task_name }}
                {% endif %}
            </td>
            <td class="px-6 py-4">
                <span class="task-status-badge status-{{ task.status }}">{{ task.status }}</span>
            </td>
            <td class="px-6 py-4">
                {% set progress_percentage = (task.progress / task.total * 100) if task.total > 0 else 0 %}
                <div class="progress-bar-container w-32">
                    <div class="progress-bar-fill" style="width: {{ progress_percentage }}%;">{{ progress_percentage|int
                        }}%</div>
                </div>
            </td>
            <td class="px-6 py-4 text-slate-600 max-w-xs truncate" title="{{ task.message }}">{{ task.message }}</td>
            <td class="px-6 py-4">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" value="" class="sr-only peer toggle-task-checkbox" {% if task.is_enabled
                        %}checked{% endif %} {% if task.status=='running' %}disabled{% endif %}>
                    <div
                        class="w-11 h-6 bg-slate-300 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-200 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[3px] after:bg-white after:border-slate-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                    </div>
                </label>
            </td>
            <td class="px-6 py-4">
                <div class="flex flex-col gap-3">
                    {% if task.task_name == 'generate_audio_cache' %}
                    <div>
                        <select
                            class="w-full border border-slate-200 rounded-lg px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-blue-400 container-scope-select"
                            {% if task.status=='running' %}disabled{% endif %}>
                            <option value="">All Flashcards</option>
                            {% for container in flashcard_containers %}
                            <option value="{{ container.container_id }}">{{ container.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}

                    <div class="flex items-center gap-2">
                        <button type="button"
                            class="inline-flex items-center gap-2 px-3 py-1.5 rounded-md transition action-button task-toggle-btn {% if task.status == 'running' %}bg-rose-100 text-rose-700 hover:bg-rose-200{% else %}bg-emerald-100 text-emerald-700 hover:bg-emerald-200{% endif %}"
                            data-state="{{ 'stop' if task.status == 'running' else 'start' }}" {% if task.status
                            !='running' and not task.is_enabled %}disabled{% endif %}>
                            <i class="fas {% if task.status == 'running' %}fa-stop{% else %}fa-play{% endif %}"></i>
                            <span class="text-sm font-semibold task-toggle-label">{{ 'Stop' if task.status == 'running'
                                else 'Start' }}</span>
                        </button>
                        <a href="{{ url_for('admin.view_task_logs', task_id=task.task_id) }}"
                            class="text-slate-500 hover:text-slate-700" title="View Logs">
                            <i class="fas fa-list-alt text-lg"></i>
                        </a>
                    </div>
                </div>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>
