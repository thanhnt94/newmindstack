{#
File: mindstack_app/templates/lumina/components/_modal.html
Purpose: Modal dialog component macro
#}

{#
Modal Macro
Usage:
{% call modal(id='my-modal', title='Modal Title', size='md') %}
<p>Modal content here</p>
{% endcall %}
#}
{% macro modal(id, title, size='md', show_footer=True) %}
{% set size_class = {
'sm': 'max-width: 400px;',
'md': 'max-width: 560px;',
'lg': 'max-width: 720px;',
'xl': 'max-width: 900px;',
'full': 'max-width: calc(100vw - 32px); max-height: calc(100vh - 32px);'
}[size] or 'max-width: 560px;' %}

<div id="{{ id }}" class="lumina-modal" style="display: none;">
    {# Backdrop #}
    <div class="lumina-modal__backdrop" onclick="LuminaModal.close('{{ id }}')"></div>

    {# Content #}
    <div class="lumina-modal__content" style="{{ size_class }}">
        {# Header #}
        <div class="lumina-modal__header">
            <h3 class="lumina-modal__title">{{ title }}</h3>
            <button type="button" class="lumina-modal__close" onclick="LuminaModal.close('{{ id }}')" title="Đóng">
                <i class="fas fa-times"></i>
            </button>
        </div>

        {# Body #}
        <div class="lumina-modal__body">
            {{ caller() if caller else '' }}
        </div>

        {% if show_footer %}
        {# Footer #}
        <div class="lumina-modal__footer" id="{{ id }}-footer">
            {# Default buttons - can be overridden by JS #}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{# Modal Styles (inline) #}
<style>
    .lumina-modal {
        position: fixed;
        inset: 0;
        z-index: var(--z-modal);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-4);
    }

    .lumina-modal__backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    .lumina-modal__content {
        position: relative;
        background: var(--lumina-surface);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        width: 100%;
        max-height: calc(100vh - 64px);
        display: flex;
        flex-direction: column;
        animation: modalSlideIn 0.2s ease-out;
    }

    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-20px) scale(0.95);
        }

        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .lumina-modal__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--space-5) var(--space-6);
        border-bottom: 1px solid var(--lumina-border-light);
    }

    .lumina-modal__title {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-semibold);
        color: var(--lumina-text);
        margin: 0;
    }

    .lumina-modal__close {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-md);
        color: var(--lumina-text-muted);
        transition: all var(--transition-fast);
    }

    .lumina-modal__close:hover {
        background: var(--lumina-border-light);
        color: var(--lumina-text);
    }

    .lumina-modal__body {
        flex: 1;
        padding: var(--space-6);
        overflow-y: auto;
    }

    .lumina-modal__footer {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: var(--space-3);
        padding: var(--space-4) var(--space-6);
        border-top: 1px solid var(--lumina-border-light);
    }
</style>

{# Modal JavaScript #}
<script>
    window.LuminaModal = {
        open: function (id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        },
        close: function (id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        },
        toggle: function (id) {
            const modal = document.getElementById(id);
            if (modal) {
                if (modal.style.display === 'none' || !modal.style.display) {
                    this.open(id);
                } else {
                    this.close(id);
                }
            }
        }
    };

    // Close modal on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            const openModal = document.querySelector('.lumina-modal[style*="display: flex"], .lumina-modal[style*="display:flex"]');
            if (openModal) {
                LuminaModal.close(openModal.id);
            }
        }
    });
</script>