{% set _v = template_version|default('v4') %}
{% extends _v ~ '/base.html' %}
{% block title %}Tổng kết phiên học - {{ summary.mode_name }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-50 flex flex-col">
    <!-- Header with Confetti Background -->
    <div class="relative bg-gradient-to-br from-indigo-600 to-violet-700 pb-24 pt-12 overflow-hidden">
        <!-- Decorative circles -->
        <div class="absolute top-0 left-0 w-64 h-64 bg-white/10 rounded-full -translate-x-1/2 -translate-y-1/2"></div>
        <div class="absolute bottom-0 right-0 w-96 h-96 bg-white/5 rounded-full translate-x-1/3 translate-y-1/3"></div>

        <div class="container mx-auto px-4 relative z-10 text-center">
            <div
                class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-md rounded-2xl mb-6 shadow-xl ring-4 ring-white/10">
                <i class="fas fa-trophy text-4xl text-amber-300 drop-shadow-md"></i>
            </div>

            <h1 class="text-3xl md:text-4xl font-black text-white mb-2 tracking-tight">Hoàn thành phiên học!</h1>
            <p class="text-indigo-100 text-lg font-medium">{{ summary.container_name }} • {{ summary.mode_name }}</p>
        </div>
    </div>

    <!-- Stats Cars Container -->
    <div class="container mx-auto px-4 -mt-16 pb-12 relative z-20 max-w-4xl">
        <!-- Main Stats Grid -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <!-- Accuracy -->
            <div class="bg-white rounded-2xl p-6 shadow-xl shadow-indigo-900/5 text-center border border-slate-100">
                <div class="text-emerald-500 mb-2">
                    <i class="fas fa-bullseye text-2xl"></i>
                </div>
                <div class="text-3xl font-black text-slate-800 tracking-tight">{{ summary.accuracy }}%</div>
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wide">Chính xác</div>
            </div>

            <!-- Points -->
            <div class="bg-white rounded-2xl p-6 shadow-xl shadow-indigo-900/5 text-center border border-slate-100">
                <div class="text-amber-500 mb-2">
                    <i class="fas fa-gem text-2xl"></i>
                </div>
                <div class="text-3xl font-black text-slate-800 tracking-tight">+{{ summary.points }}</div>
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wide">Điểm số</div>
            </div>

            <!-- Correct/Total -->
            <div class="bg-white rounded-2xl p-6 shadow-xl shadow-indigo-900/5 text-center border border-slate-100">
                <div class="text-indigo-500 mb-2">
                    <i class="fas fa-check-circle text-2xl"></i>
                </div>
                <div class="text-3xl font-black text-slate-800 tracking-tight">{{ summary.correct }}/{{ summary.total }}
                </div>
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wide">Số câu đúng</div>
            </div>

            <!-- Time -->
            <div class="bg-white rounded-2xl p-6 shadow-xl shadow-indigo-900/5 text-center border border-slate-100">
                <div class="text-blue-500 mb-2">
                    <i class="fas fa-clock text-2xl"></i>
                </div>
                <div class="text-3xl font-black text-slate-800 tracking-tight">{{ summary.duration }}</div>
                <div class="text-xs font-bold text-slate-400 uppercase tracking-wide">Thời gian</div>
            </div>
        </div>

        <!-- Detailed Breakdown Card (Placeholder call to action) -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
            <div class="p-6 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between">
                <h3 class="font-bold text-slate-700 text-lg">Chi tiết phiên học</h3>
                <span class="text-xs font-semibold px-2.5 py-1 bg-slate-200 text-slate-600 rounded-md">
                    {{ summary.start_time.strftime('%H:%M %d/%m') }}
                </span>
            </div>

            <div class="p-8 text-center">
                <div
                    class="inline-flex items-center justify-center w-16 h-16 bg-indigo-50 text-indigo-500 rounded-full mb-4">
                    <i class="fas fa-clipboard-list text-2xl"></i>
                </div>
                <h4 class="text-lg font-bold text-slate-800 mb-2">Xem lại các câu hỏi</h4>
                <p class="text-slate-500 max-w-md mx-auto mb-6">Bạn có thể xem lại chi tiết lịch sử học tập và các câu
                    trả lời đúng/sai trong phần thống kê chi tiết của bộ học.</p>

                {% if set_id %}
                <a href="{{ url_for('learning.vocabulary.mcq.setup', set_id=set_id) }}"
                    class="inline-flex items-center gap-2 font-bold text-indigo-600 hover:text-indigo-700 bg-indigo-50 hover:bg-indigo-100 px-5 py-2.5 rounded-xl transition-colors">
                    <i class="fas fa-arrow-left"></i> Quay lại Setup
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="{{ url_for('dashboard.dashboard') }}"
                class="flex items-center justify-center gap-3 py-4 bg-white border-2 border-slate-200 text-slate-600 font-bold rounded-2xl hover:border-slate-300 hover:bg-slate-50 transition-all shadow-sm group">
                <i class="fas fa-home group-hover:scale-110 transition-transform"></i>
                Về Trang chủ
            </a>

            <a href="javascript:history.back()"
                class="flex items-center justify-center gap-3 py-4 bg-indigo-600 text-white font-bold rounded-2xl hover:bg-indigo-700 hover:shadow-lg hover:shadow-indigo-500/25 transition-all group">
                <i class="fas fa-redo group-hover:rotate-180 transition-transform duration-500"></i>
                Học tiếp
            </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    // Celebration Confetti
    document.addEventListener('DOMContentLoaded', () => {
        const duration = 3000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        function random(min, max) {
            return Math.random() * (max - min) + min;
        }

        const interval = setInterval(function () {
            const timeLeft = animationEnd - Date.now();

            if (timeLeft <= 0) {
                return clearInterval(interval);
            }

            const particleCount = 50 * (timeLeft / duration);

            // since particles fall down, start a bit higher than random
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    });
</script>
{% endblock %}