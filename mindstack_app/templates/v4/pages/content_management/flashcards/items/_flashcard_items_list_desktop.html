{% set _v = template_version|default('v4') %}
<!-- File: _flashcard_items_list_desktop.html -->
<!-- Phiên bản: 1.0 -->
<!-- Desktop version: hidden on mobile, shown on lg+ -->

{% from _v ~ '/includes/search/_search_form.html' import render_search_form %}
{% from _v ~ '/includes/pagination/_pagination.html' import render_pagination %}

<div class="hidden lg:block cm-container space-y-6">
    <div class="cm-section-header">
        <div class="cm-heading-group">
            <a href="{{ url_for('content_management.content_dashboard', tab='flashcards') }}" class="cm-link text-sm">
                <i class="fa-solid fa-arrow-left"></i>
                <span>Quay lại bảng điều khiển</span>
            </a>
            <span class="cm-eyebrow">Bộ thẻ ghi nhớ</span>
            <h1 class="cm-heading">{{ flashcard_set.title }}</h1>
            <p class="cm-subheading">{{ (flashcard_set.description or 'Quản lý cặp thẻ, sắp xếp thứ tự và cập nhật nội
                dung nhanh chóng.') | truncate(110, True, '…') }}</p>
            <div class="cm-chip-row">
                <span class="cm-pill cm-pill--accent">
                    <i class="fa-solid fa-clone"></i>
                    {{ pagination.total }} thẻ
                </span>
            </div>
        </div>
        {% if can_edit %}
        <div class="cm-actions">
            <a href="{{ url_for('content_management.content_management_flashcards.add_flashcard_item', set_id=flashcard_set.container_id) }}"
                data-modal-url="{{ url_for('content_management.content_management_flashcards.add_flashcard_item', set_id=flashcard_set.container_id) }}"
                class="open-modal-btn cm-action cm-action--primary">
                <i class="fas fa-plus-circle"></i>
                <span>Thêm thẻ mới</span>
            </a>
            <a href="{{ url_for('content_management.content_management_flashcards.export_flashcard_set', set_id=flashcard_set.container_id) }}"
                class="cm-action cm-action--ghost">
                <i class="fas fa-file-export"></i>
                <span>Xuất gói ZIP</span>
            </a>

        </div>
        {% endif %}
    </div>

    <div class="cm-card cm-card--padded">
        {% set display_item_search_options = {
        'front': 'Mặt trước',
        'back': 'Mặt sau',
        'front_audio_content': 'Audio mặt trước (text)',
        'back_audio_content': 'Audio mặt sau (text)',
        'front_img': 'Ảnh mặt trước (URL)',
        'back_img': 'Ảnh mặt sau (URL)'
        } %}
        <div class="cm-search-header">
            <div class="cm-heading-group">
                <h2 class="text-lg font-semibold text-slate-800">Tìm kiếm thẻ</h2>
                <p class="cm-subheading text-sm">Kết hợp bộ lọc và tìm kiếm để chỉnh sửa nhanh các cặp thẻ quan trọng.
                </p>
            </div>
            <div class="w-full md:w-auto md:min-w-[320px]">
                {{ render_search_form(search_query=search_query, placeholder="Tìm kiếm thẻ...",
                set_id=flashcard_set.container_id, search_field=search_field,
                search_options=display_item_search_options) }}
            </div>
        </div>
    </div>

    {% if flashcard_items %}
    <div class="cm-grid cm-grid--three">
        {% for item in flashcard_items %}
        <article class="cm-collection-card">
            <div class="flex items-start justify-between gap-4">
                <div class="space-y-3">
                    <div class="cm-chip-row text-xs font-semibold">
                        <span class="cm-pill cm-pill--accent">
                            <i class="fa-solid fa-clone"></i>
                            Thẻ #<span data-order-label>{{ item.order_in_container }}</span>
                        </span>
                        <span class="cm-pill cm-pill--neutral">
                            <i class="fa-solid fa-id-card-clip"></i>
                            ID {{ item.item_id }}
                        </span>
                    </div>
                    <div class="space-y-2">
                        <h3 class="text-sm font-semibold uppercase tracking-wide text-slate-400">Mặt trước</h3>
                        <p class="text-base font-semibold text-slate-900">{{ item.content.front }}</p>
                        <h3 class="text-sm font-semibold uppercase tracking-wide text-slate-400">Mặt sau</h3>
                        <p class="text-sm text-slate-600">{{ item.content.back }}</p>
                    </div>
                </div>
            </div>

            <div class="mt-4 space-y-2 text-xs text-slate-500">
                <div class="cm-chip-row">
                    {% if item.content.front_audio_content or item.content.front_audio_url %}
                    <span class="cm-tag">
                        <i class="fa-solid fa-volume-high text-slate-400"></i>
                        Audio mặt trước
                    </span>
                    {% endif %}
                    {% if item.content.back_audio_content or item.content.back_audio_url %}
                    <span class="cm-tag">
                        <i class="fa-solid fa-volume-high text-slate-400"></i>
                        Audio mặt sau
                    </span>
                    {% endif %}
                    {% if item.content.front_img or item.content.back_img %}
                    <span class="cm-tag">
                        <i class="fa-solid fa-image text-slate-400"></i>
                        Hình ảnh
                    </span>
                    {% endif %}
                </div>
                {% if item.ai_explanation %}
                <div class="rounded-2xl bg-slate-50 px-4 py-2 text-[0.75rem] text-slate-500 group relative">
                    <span class="font-semibold text-slate-600 block mb-1">Giải thích AI:</span>
                    <div class="line-clamp-3">
                        {{ item.ai_explanation }}
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="cm-divider"></div>
            <div class="flex items-center justify-between">
                <a href="{{ url_for('content_management.content_management_flashcards.edit_flashcard_item', set_id=flashcard_set.container_id, item_id=item.item_id) }}"
                    data-modal-url="{{ url_for('content_management.content_management_flashcards.edit_flashcard_item', set_id=flashcard_set.container_id, item_id=item.item_id) }}"
                    class="open-modal-btn cm-link">
                    <i class="fa-solid fa-pen-to-square"></i>
                    <span>Mở trình chỉnh sửa</span>
                </a>
                {% if can_edit %}
                <div class="cm-inline-actions">
                    <button type="button"
                        data-modal-url="{{ url_for('content_management.content_management_flashcards.edit_flashcard_item', set_id=flashcard_set.container_id, item_id=item.item_id) }}"
                        class="open-modal-btn cm-icon-button" title="Chỉnh sửa">
                        <i class="fa-solid fa-pen"></i>
                    </button>
                    <form
                        action="{{ url_for('content_management.content_management_flashcards.delete_flashcard_item', set_id=flashcard_set.container_id, item_id=item.item_id) }}"
                        method="post" onsubmit="return confirm('Bạn có chắc chắn muốn xóa thẻ này?');">
                        <button type="submit" class="cm-icon-button" title="Xoá thẻ">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
        </article>
        {% endfor %}
    </div>

    <div class="pt-6">
        {{ render_pagination(pagination=pagination, search_query=search_query, set_id=flashcard_set.container_id,
        search_field=search_field) }}
    </div>

    {% else %}
    <div class="cm-empty">
        <span class="cm-empty-icon">
            <i class="fa-solid fa-clone"></i>
        </span>
        <p class="text-sm">Bộ thẻ này chưa có thẻ nào hoặc không tìm thấy kết quả phù hợp.</p>
        {% if can_edit %}
        <a href="{{ url_for('content_management.content_management_flashcards.add_flashcard_item', set_id=flashcard_set.container_id) }}"
            data-modal-url="{{ url_for('content_management.content_management_flashcards.add_flashcard_item', set_id=flashcard_set.container_id) }}"
            class="open-modal-btn cm-action cm-action--primary">
            <i class="fas fa-plus-circle"></i>
            <span>Thêm thẻ đầu tiên</span>
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>