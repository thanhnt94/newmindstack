{# Quiz Learning Hub - Refactored Modular Structure #}
{% set _v = template_version %}
{% extends _v ~ '/base.html' %}
{% block title %}Hoc Quiz - MindStack{% endblock %}
{% block head %}
{{ super() }}
{% include _v ~ '/includes/assets/_markdown_assets.html' %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
{# Load modular CSS files #}
<style>
    {
        % include _v~'/pages/learning/quiz/dashboard/css/dashboard.css' %
    }
</style>
<style>
    {
        % include _v~'/pages/learning/quiz/dashboard/css/dashboard-mobile.css' %
    }
</style>
{% endblock %}
{% block content %}
{# ========== UNIFIED MOBILE VIEW ========== #}
<div id="unified-quiz-dashboard">
    <div id="step-browser" class="quiz-step active">
        <div class="quiz-header">
            <a href="{{ url_for('stats.dashboard') }}" class="quiz-back-btn"><i class="fas fa-arrow-left"></i></a>
            <span class="quiz-title">Hoc Quiz</span>
            <a href="/dashboard" class="quiz-back-btn" title="Ve trang chu" style="margin-left: auto;"><i
                    class="fas fa-home"></i></a>
        </div>
        <div class="quiz-search-wrap">
            <div class="quiz-search">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Tim kiem bo quiz...">
            </div>
        </div>
        <div class="quiz-tabs">
            <div class="quiz-tab active" data-category="my">Cua toi</div>
            <div class="quiz-tab" data-category="learning">Dang hoc</div>
            <div class="quiz-tab" data-category="explore">Kham pha</div>
        </div>
        <div class="quiz-scroll" style="padding-bottom: 80px;">
            <div id="sets-grid" class="quiz-grid">
                <div class="quiz-loading"><i class="fas fa-spinner fa-spin"></i>
                    <p>Dang tai...</p>
                </div>
            </div>
        </div>
        <div id="pagination-bar" class="quiz-pagination-bar">
            <button class="pagination-nav-btn js-prev-page" disabled><i class="fas fa-chevron-left"></i></button>
            <div class="pagination-pages js-page-numbers"><span class="page-num active">1</span></div>
            <button class="pagination-nav-btn js-next-page" disabled><i class="fas fa-chevron-right"></i></button>
        </div>
    </div>
    <div id="step-detail" class="quiz-step">
        <div class="step-header">
            <a href="javascript:void(0)" class="step-back-btn js-back-to-browser"><i class="fas fa-arrow-left"></i></a>
            <div class="step-header-info" style="opacity: 0; transition: opacity 0.3s;">
                <div class="step-header-title js-header-title">Ten bo quiz</div>
                <div class="step-header-meta"><span class="js-header-count">0</span> cau hoi</div>
            </div>
            <a href="/dashboard" class="step-home-btn" title="Ve trang chu"><i class="fas fa-home"></i></a>
        </div>
        <div class="quiz-scroll">
            <div class="quiz-detail-hero js-detail-cover"><i class="fas fa-question-circle"></i></div>
            <div class="quiz-detail-content" style="opacity: 0; transition: opacity 0.3s;">
                <h1 class="quiz-detail-title js-detail-title">Ten bo quiz</h1>
                <div class="quiz-creator-inline">
                    <div class="quiz-creator-avatar-small js-creator-avatar">A</div>
                    <span class="quiz-creator-name-small js-creator-name">Admin</span>
                </div>
                <p class="quiz-detail-desc js-detail-desc">Mo ta bo quiz...</p>
                <div class="quiz-detail-stats">
                    <div class="quiz-stat">
                        <div class="quiz-stat-value js-question-count">0</div>
                        <div class="quiz-stat-label">Cau hoi</div>
                    </div>
                    <div class="quiz-stat">
                        <div class="quiz-stat-value quiz-stat-count js-progress-count">0/0</div>
                        <div class="quiz-stat-label">Da hoc</div>
                    </div>
                </div>
                <h3 class="font-bold text-slate-700 mb-3 mt-6">Danh sach cau hoi</h3>
                <div class="js-question-list">
                    <div class="py-12 flex justify-center"><i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                    </div>
                </div>
                <div style="height: 100px;"></div>
            </div>
        </div>
        <div class="quiz-footer"><button class="quiz-start-btn js-start-learning"><i class="fas fa-play-circle"></i> Bat
                dau hoc</button></div>
    </div>
    <div id="step-modes" class="quiz-step">
        <div class="step-header">
            <a href="javascript:void(0)" class="step-back-btn js-back-to-detail"><i class="fas fa-arrow-left"></i></a>
            <div class="step-header-info">
                <div class="step-header-title">Chon che do hoc</div>
            </div>
            <a href="/dashboard" class="step-home-btn" title="Ve trang chu"><i class="fas fa-home"></i></a>
        </div>
        <div class="quiz-scroll" style="padding: 1rem;">
            <div class="js-modes-container"></div>
        </div>
        <div class="quiz-footer">
            <div class="config-card">
                <div class="flex justify-between items-center">
                    <div class="config-header"><i class="fas fa-sort-numeric-up"></i> So luong: <span
                            id="limit-status-text" class="text-blue-500 font-semibold">Tat ca</span></div>
                    <label class="flex items-center cursor-pointer">
                        <span class="mr-2 text-sm font-medium text-gray-600">Tuy chinh</span>
                        <div class="relative">
                            <input type="checkbox" id="limit-toggle" class="sr-only">
                            <div class="block bg-gray-200 w-10 h-6 rounded-full transition-colors toggle-bg"></div>
                            <div
                                class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform transform">
                            </div>
                        </div>
                    </label>
                </div>
                <div id="limit-options" class="hidden mt-3">
                    <select id="session-size-select" class="session-size-select w-full">
                        <option value="5">5 cau</option>
                        <option value="10" selected>10 cau</option>
                        <option value="20">20 cau</option>
                        <option value="30">30 cau</option>
                        <option value="50">50 cau</option>
                        <option value="100">100 cau</option>
                    </select>
                </div>
            </div>
            <div class="config-card mt-3">
                <div class="flex justify-between items-center">
                    <div class="config-header"><i class="fas fa-layer-group"></i> Luot: <span id="turn-status-text"
                            class="text-blue-500 font-semibold">1 cau</span></div>
                    <label class="flex items-center cursor-pointer">
                        <span class="mr-2 text-sm font-medium text-gray-600">Tuy chinh</span>
                        <div class="relative">
                            <input type="checkbox" id="turn-toggle" class="sr-only">
                            <div class="block bg-gray-200 w-10 h-6 rounded-full transition-colors toggle-bg"></div>
                            <div
                                class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform transform">
                            </div>
                        </div>
                    </label>
                </div>
                <div id="turn-options" class="hidden mt-3">
                    <select id="turn-size-select" class="session-size-select w-full">
                        <option value="1" selected>1 cau moi luot</option>
                        <option value="2">2 cau moi luot</option>
                        <option value="3">3 cau moi luot</option>
                        <option value="5">5 cau moi luot</option>
                        <option value="10">10 cau moi luot</option>
                    </select>
                </div>
            </div>
            <button class="quiz-start-btn js-start-session" disabled><i class="fas fa-play-circle"></i> Bat dau phien
                hoc</button>
        </div>
    </div>
</div>
{% endblock content %}
{% block scripts %}
{{ super() }}
<script>{% include _v ~ '/pages/learning/quiz/dashboard/js/dashboard.js' %}</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        QuizDashboard.init({
            apiSetsUrl: "{{ url_for('learning.quiz_learning.api_get_quiz_sets') }}",
            apiSetDetailUrl: "{{ url_for('learning.quiz_learning.api_get_quiz_set_detail', set_id=0) }}",
            startSessionUrl: "{{ url_for('learning.quiz_learning.start_quiz_session_by_id', set_id=0, mode='MODE') }}",
            initialSetId: {{ initial_set_id|default('null') }},
        savedBatchSize: {{ user_default_batch_size|default(10) | int }}
    });
});
</script>
{% endblock scripts %}