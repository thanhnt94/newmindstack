{% extends "v3/base.html" %}

{% block title %}Quản lý Phản hồi{% endblock %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white p-6 rounded-lg shadow-lg">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0">
            <h1 class="text-3xl font-bold text-gray-800">Quản lý Phản hồi</h1>
            <button id="open-general-feedback"
                class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 transition">
                <i class="fas fa-paper-plane mr-2"></i>
                Gửi phản hồi chung
            </button>
        </div>

        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button id="tab-received"
                    class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600">
                    Phản hồi đã nhận
                </button>
                <button id="tab-sent"
                    class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    Phản hồi đã gửi
                </button>
            </nav>
        </div>

        <div class="mt-6">
            <div id="pane-received" class="tab-pane">
                {% if received_feedbacks %}
                {% with feedbacks=received_feedbacks, table_id='received', is_owner=True %}
                {% include 'v3/pages/feedback/_feedback_table.html' %}
                {% endwith %}
                {% else %}
                <p class="text-gray-500">Bạn chưa nhận được phản hồi nào.</p>
                {% endif %}
            </div>

            <div id="pane-sent" class="tab-pane hidden">
                {% if sent_feedbacks %}
                {% with feedbacks=sent_feedbacks, table_id='sent', is_owner=False %}
                {% include 'v3/pages/feedback/_feedback_table.html' %}
                {% endwith %}
                {% else %}
                <p class="text-gray-500">Bạn chưa gửi phản hồi nào.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% include 'v3/pages/feedback/_general_feedback_modal.html' %}
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Deactivate all buttons
                tabButtons.forEach(btn => {
                    btn.classList.remove('border-blue-500', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                });

                // Activate the clicked button
                this.classList.add('border-blue-500', 'text-blue-600');
                this.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

                // Hide all panes
                const targetPaneId = this.id.replace('tab-', 'pane-');
                tabPanes.forEach(pane => {
                    if (pane.id === targetPaneId) {
                        pane.classList.remove('hidden');
                    } else {
                        pane.classList.add('hidden');
                    }
                });
            });
        });
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const openModalBtn = document.getElementById('open-general-feedback');
        if (!openModalBtn || typeof window.openGeneralFeedbackModal !== 'function') return;

        openModalBtn.addEventListener('click', function () {
            window.openGeneralFeedbackModal();
        });
    });
</script>
{% endblock %}