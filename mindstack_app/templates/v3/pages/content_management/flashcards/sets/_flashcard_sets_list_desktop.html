<!-- File: _flashcard_sets_list_desktop.html -->
<!-- Phiên bản: 1.0 -->
<!-- Desktop version: hidden on mobile, shown on lg+ -->

{% from 'v3/includes/search/_search_form.html' import render_search_form %}
{% from 'v3/includes/pagination/_pagination.html' import render_pagination %}

<div class="hidden lg:block w-full space-y-8"
    style="--cm-accent:#0284c7; --cm-accent-soft:rgba(14,165,233,0.15); --cm-accent-strong:rgba(2,132,199,0.18);">
    <div class="cm-section-header">
        <div class="cm-heading-group">
            <span class="cm-eyebrow">Thẻ ghi nhớ</span>
            <h2 class="cm-heading text-3xl">Bộ thẻ ghi nhớ</h2>
            <p class="cm-subheading">Tổ chức và chỉnh sửa mọi bộ thẻ ở cùng một nơi.</p>
        </div>
        <div class="cm-actions">
            <button type="button"
                data-modal-url="{{ url_for('content_management.content_management_flashcards.add_flashcard_set') }}"
                class="open-modal-btn cm-action cm-action--primary">
                <i class="fas fa-plus-circle"></i>
                <span>Thêm bộ thẻ</span>
            </button>
        </div>
    </div>

    <div class="cm-card cm-card--padded">
        {% set display_search_options = {
        'title': 'Tiêu đề',
        'description': 'Mô tả',
        'tags': 'Thẻ'
        } %}
        <div class="cm-search-header">
            <div class="cm-heading-group">
                <h3 class="text-lg font-semibold text-slate-800">Tìm kiếm nhanh</h3>
                <p class="cm-subheading text-sm">Lọc theo tiêu đề, mô tả hoặc thẻ để tìm nội dung cần chỉnh sửa.</p>
            </div>
            <div class="w-full md:w-auto md:min-w-[320px]">
                {{ render_search_form(search_query=search_query, placeholder="Tìm kiếm bộ thẻ...",
                search_field=search_field, search_options=display_search_options) }}
            </div>
        </div>
    </div>

    {% if flashcard_sets %}
    <div class="cm-grid cm-grid--three">
        {% for set in flashcard_sets %}
        <article class="cm-collection-card">
            <div class="flex items-start justify-between gap-4">
                <div class="min-w-0 space-y-2">
                    <h3 class="truncate text-lg font-semibold text-slate-900">{{ set.title }}</h3>
                    <p class="line-clamp-2 text-sm text-slate-500">{{ set.description if set.description else 'Chưa có
                        mô tả cho bộ thẻ này.' }}</p>
                </div>
                <span class="cm-icon-button" aria-hidden="true">
                    <i class="fa-solid fa-clone"></i>
                </span>
            </div>

            <div class="cm-collection-meta">
                <span class="cm-tag">
                    <i class="fa-solid fa-tags text-slate-400"></i>
                    <span class="truncate max-w-[160px]" title="{{ set.tags if set.tags else 'Không có thẻ' }}">{{
                        set.tags if set.tags else 'Không có thẻ' }}</span>
                </span>
                <span class="cm-tag">
                    <i class="fa-solid fa-layer-group text-slate-400"></i>
                    <span>{{ set.item_count }} thẻ</span>
                </span>
                <span class="cm-tag" title="{{ set.creator_display_name }}">
                    <i class="fa-solid fa-user-pen text-slate-400"></i>
                    <span>{{ set.creator_display_name }}</span>
                </span>
            </div>

            <div class="text-xs text-slate-500 flex items-center gap-2">
                <i class="fa-solid fa-user-shield text-slate-400"></i>
                <span class="font-semibold">Cộng tác:</span>
                <span class="truncate" title="{{ set.editor_display_names | join(', ') }}">{{ set.editor_display_names |
                    join(', ') }}</span>
            </div>

            <div class="cm-divider"></div>

            <div class="flex items-center justify-between">
                <a href="{{ url_for('content_management.content_management_flashcards.list_flashcard_items', set_id=set.container_id) }}"
                    class="cm-link">
                    <span>Quản lý thẻ</span>
                    <i class="fa-solid fa-arrow-right"></i>
                </a>
                <div class="cm-inline-actions">
                    {% if current_user.user_role == 'admin' or set.creator_user_id == current_user.user_id or
                    (set.contributors and current_user.user_id in set.contributors|map(attribute='user_id')|list and
                    'editor' in set.contributors|selectattr('user_id', 'equalto',
                    current_user.user_id)|map(attribute='permission_level')|list) %}
                    <a href="{{ url_for('content_management.content_management_flashcards.export_flashcard_set', set_id=set.container_id) }}"
                        class="cm-icon-button" title="Xuất gói ZIP">
                        <i class="fas fa-file-export"></i>
                    </a>
                    <button type="button"
                        data-modal-url="{{ url_for('content_management.content_management_flashcards.edit_flashcard_set', set_id=set.container_id) }}"
                        class="open-modal-btn cm-icon-button" title="Chỉnh sửa">
                        <i class="fas fa-pen"></i>
                    </button>
                    {% endif %}

                    {% if current_user.user_role != 'free' and (current_user.user_role == 'admin' or set.creator_user_id
                    == current_user.user_id) %}
                    <a href="{{ url_for('content_management.manage_contributors', container_id=set.container_id) }}"
                        class="cm-icon-button" title="Quản lý quyền">
                        <i class="fas fa-users"></i>
                    </a>
                    {% endif %}

                    {% if current_user.user_role == 'admin' or set.creator_user_id == current_user.user_id %}
                    <form
                        action="{{ url_for('content_management.content_management_flashcards.delete_flashcard_set', set_id=set.container_id) }}"
                        method="post"
                        onsubmit="return confirm('Bạn có chắc chắn muốn xóa bộ thẻ này và tất cả các thẻ của nó?');"
                        class="inline">
                        <button type="submit" class="cm-icon-button" title="Xoá bộ thẻ">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
        </article>
        {% endfor %}
    </div>
    <div class="pt-4">
        {{ render_pagination(pagination=pagination, search_query=search_query, search_field=search_field) }}
    </div>
    {% else %}
    <div class="cm-empty">
        <span class="cm-empty-icon">
            <i class="fas fa-clone"></i>
        </span>
        <h3 class="text-lg font-semibold text-slate-700">Chưa có bộ thẻ nào</h3>
        <p class="text-sm">Tạo bộ thẻ đầu tiên để bắt đầu luyện ghi nhớ.</p>
    </div>
    {% endif %}
</div>