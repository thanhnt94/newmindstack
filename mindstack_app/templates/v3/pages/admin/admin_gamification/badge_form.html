{% extends "v3/pages/admin/admin_layout.html" %}

{% block title %}{{ 'Sửa' if badge else 'Tạo' }} Huy hiệu{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-lg shadow-sm p-6">
    <div class="flex items-center mb-6">
        <a href="{{ url_for('admin.list_badges') }}" class="mr-4 text-gray-500 hover:text-gray-700">
            <i class="fas fa-arrow-left"></i>
        </a>
        <h2 class="text-xl font-bold text-gray-800">{{ 'Chỉnh sửa' if badge else 'Tạo mới' }} Huy hiệu</h2>
    </div>

    <form method="POST" class="space-y-6">
        <!-- Name -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Tên Huy hiệu</label>
            <input type="text" name="name" value="{{ badge.name if badge else '' }}" required
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>

        <!-- Description -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Mô tả</label>
            <textarea name="description" rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">{{ badge.description if badge else '' }}</textarea>
        </div>

        <!-- Icon Selection -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Biểu tượng (Icon)</label>
            <div class="flex items-center mb-3">
                <input type="text" name="icon_class" id="icon-input"
                    value="{{ badge.icon_class if badge else 'fas fa-medal' }}"
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Nhập class FontAwesome (ví dụ: fas fa-star)">
                <div
                    class="px-3 py-2 bg-gray-100 border border-l-0 border-gray-300 rounded-r-md text-gray-600 min-w-[3.5rem] flex justify-center">
                    <i id="icon-preview" class="{{ badge.icon_class if badge else 'fas fa-medal' }} text-xl"></i>
                </div>
            </div>

            <!-- Quick Select Grid -->
            <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                <p class="text-xs text-slate-500 mb-3 font-medium uppercase tracking-wide">Kho biểu tượng mở rộng:</p>
                <div
                    class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2 max-h-80 overflow-y-auto custom-scrollbar p-1">
                    {% set icon_suggestions = [
                    'fas fa-medal', 'fas fa-trophy', 'fas fa-crown', 'fas fa-award', 'fas fa-star', 'fas
                    fa-certificate', 'fas fa-ribbon',
                    'fas fa-fire', 'fas fa-fire-alt', 'fas fa-bolt', 'fas fa-running', 'fas fa-calendar-check', 'fas
                    fa-calendar-alt', 'fas fa-calendar-day', 'fas fa-calendar-week',
                    'fas fa-clock', 'fas fa-hourglass-half', 'fas fa-history', 'fas fa-stopwatch', 'fas
                    fa-hourglass-end',
                    'fas fa-coins', 'fas fa-gem', 'fas fa-diamond', 'fas fa-money-bill-wave', 'fas fa-chart-line', 'fas
                    fa-chart-bar', 'fas fa-chart-pie',
                    'fas fa-bullseye', 'fas fa-crosshairs', 'fas fa-tasks', 'fas fa-clipboard-check', 'fas fa-list-ol',
                    'fas fa-check-double',
                    'fas fa-book', 'fas fa-book-open', 'fas fa-graduation-cap', 'fas fa-brain', 'fas fa-lightbulb', 'fas
                    fa-puzzle-piece', 'fas fa-flask', 'fas fa-microscope',
                    'fas fa-gamepad', 'fas fa-ghost', 'fas fa-heart', 'fas fa-thumbs-up', 'fas fa-rocket', 'fas
                    fa-check-circle', 'fas fa-infinity',
                    'fas fa-shield-alt', 'fas fa-dungeon', 'fas fa-dragon', 'fas fa-hat-wizard', 'fas fa-magic', 'fas
                    fa-scroll', 'fas fa-fist-raised', 'fas fa-hand-rock',
                    'fas fa-leaf', 'fas fa-seedling', 'fas fa-tree', 'fas fa-water', 'fas fa-wind', 'fas fa-mountain',
                    'fas fa-globe-asia',
                    'fas fa-user-astronaut', 'fas fa-user-graduate', 'fas fa-user-ninja', 'fas fa-user-secret', 'fas
                    fa-smile-wink',
                    'fas fa-school', 'fas fa-university', 'fas fa-pencil-alt', 'fas fa-pen-nib', 'fas fa-ruler',
                    'fas fa-comment', 'fas fa-comments', 'fas fa-paper-plane', 'fas fa-envelope',
                    'fas fa-user-friends', 'fas fa-users', 'fas fa-user-tie', 'fas fa-user-check', 'fas fa-user-clock',
                    'fas fa-lock', 'fas fa-unlock', 'fas fa-key', 'fas fa-bell', 'fas fa-search', 'fas fa-tag',
                    'fas fa-smile', 'fas fa-meh', 'fas fa-frown', 'fas fa-laugh', 'fas fa-surprise',
                    'fas fa-anchor', 'fas fa-ship', 'fas fa-plane', 'fas fa-car', 'fas fa-bicycle',
                    'fas fa-sun', 'fas fa-moon', 'fas fa-cloud', 'fas fa-snowflake', 'fas fa-umbrella',
                    'fas fa-coffee', 'fas fa-mug-hot', 'fas fa-utensils', 'fas fa-hamburger', 'fas fa-pizza-slice',
                    'fas fa-music', 'fas fa-headphones', 'fas fa-volume-up', 'fas fa-video', 'fas fa-camera',
                    'fas fa-laptop', 'fas fa-desktop', 'fas fa-mobile-alt', 'fas fa-keyboard', 'fas fa-mouse',
                    'fas fa-tools', 'fas fa-wrench', 'fas fa-hammer', 'fas fa-screwdriver', 'fas fa-cog',
                    'fas fa-palette', 'fas fa-paint-brush', 'fas fa-highlighter', 'fas fa-eraser', 'fas fa-cut',
                    'fas fa-bug', 'fas fa-code', 'fas fa-terminal', 'fas fa-database', 'fas fa-server',
                    'fas fa-power-off', 'fas fa-signal', 'fas fa-wifi', 'fas fa-battery-full', 'fas fa-columns',
                    'fas fa-dice', 'fas fa-chess-knight', 'fas fa-chess-king', 'fas fa-chess-queen', 'fas
                    fa-puzzle-piece',
                    'fas fa-gift', 'fas fa-birthday-cake', 'fas fa-glass-cheers', 'fas fa-wine-glass', 'fas fa-cocktail'
                    ] %}
                    {% for icon in icon_suggestions %}
                    <button type="button" onclick="selectIcon('{{ icon }}')"
                        class="aspect-square flex items-center justify-center rounded-lg bg-white border border-slate-200 text-slate-600 hover:border-blue-500 hover:text-blue-600 hover:shadow-md transition-all text-lg group"
                        title="{{ icon }}">
                        <i class="{{ icon }} group-hover:scale-110 transition-transform"></i>
                    </button>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Condition Type -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Loại điều kiện</label>
                <select name="condition_type"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <option value="STREAK" {{ 'selected' if badge and badge.condition_type=='STREAK' else '' }}>Chuỗi
                        ngày (Streak)</option>
                    <option value="TOTAL_SCORE" {{ 'selected' if badge and badge.condition_type=='TOTAL_SCORE' else ''
                        }}>Tổng điểm</option>
                    <option value="FLASHCARD_COUNT" {{ 'selected' if badge and badge.condition_type=='FLASHCARD_COUNT'
                        else '' }}>Số Flashcard đã học</option>
                    <option value="QUIZ_COUNT" {{ 'selected' if badge and badge.condition_type=='QUIZ_COUNT' else '' }}>
                        Số câu Quiz đúng</option>
                </select>
            </div>

            <!-- Condition Value -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Giá trị đạt được</label>
                <input type="number" name="condition_value" value="{{ badge.condition_value if badge else 10 }}"
                    required min="1"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            </div>
        </div>

        <!-- Reward Points -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Điểm thưởng</label>
            <input type="number" name="reward_points" value="{{ badge.reward_points if badge else 0 }}" min="0"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
        </div>

        <!-- Is Active -->
        <div class="flex items-center">
            <input type="checkbox" name="is_active" id="is_active" {{ 'checked' if not badge or badge.is_active else ''
                }} class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
            <label for="is_active" class="ml-2 block text-sm text-gray-900">
                Kích hoạt ngay
            </label>
        </div>

        <!-- Actions -->
        <div class="flex justify-end pt-4 border-t">
            <a href="{{ url_for('admin.list_badges') }}"
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 mr-3">
                Hủy
            </a>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-sm">
                {{ 'Cập nhật' if badge else 'Tạo Huy hiệu' }}
            </button>
        </div>
    </form>
</div>

<script>
    function selectIcon(iconClass) {
        document.getElementById('icon-input').value = iconClass;
        document.getElementById('icon-preview').className = iconClass + ' text-xl';
    }

    document.getElementById('icon-input').addEventListener('input', function (e) {
        document.getElementById('icon-preview').className = e.target.value + ' text-xl';
    });
</script>
{% endblock %}
